<!doctype html><html lang=zh-cn><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><title>Laravel 路由 - Joker-desire's Blog</title><meta name=Description content="为什么要努力？ 因为我喜欢的东西都很贵，我想去的地方都很远，我爱的人超完美。"><meta property="og:url" content="https://Joker-desire.github.io/2023/05/learn01/">
<meta property="og:site_name" content="Joker-desire's Blog"><meta property="og:title" content="Laravel 路由"><meta property="og:description" content="基本路由 基本路由 最基本的Laravel路由仅接受URI和一个闭包： 1 2 3 Route::get(&#34;foo&#34;, function () { return 'Hello PHP'; }); 可用的路由器方法 路由器允许注册响应任何HTTP动词的"><meta property="og:locale" content="zh_cn"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-05-08T12:43:41+08:00"><meta property="article:modified_time" content="2023-05-08T12:43:41+08:00"><meta property="article:tag" content="PHP"><meta property="article:tag" content="Laravel"><meta property="og:image" content="https://Joker-desire.github.io/logo.png"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://Joker-desire.github.io/logo.png"><meta name=twitter:title content="Laravel 路由"><meta name=twitter:description content="基本路由 基本路由 最基本的Laravel路由仅接受URI和一个闭包： 1 2 3 Route::get(&#34;foo&#34;, function () { return 'Hello PHP'; }); 可用的路由器方法 路由器允许注册响应任何HTTP动词的"><meta name=application-name content="Joker-desire"><meta name=apple-mobile-web-app-title content="Joker-desire"><meta name=theme-color content="#ffffff"><meta name=msapplication-TileColor content="#da532c"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=manifest href=/site.webmanifest><link rel=canonical href=https://Joker-desire.github.io/2023/05/learn01/><link rel=prev href=https://Joker-desire.github.io/2023/04/php%E5%85%A5%E9%97%A8/><link rel=next href=https://Joker-desire.github.io/2023/05/go%E7%BB%93%E6%9E%84%E4%BD%93/><link rel=stylesheet href=/css/style.min.css><link rel=preload href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css as=style onload='this.onload=null,this.rel="stylesheet"'><noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css></noscript><link rel=preload href=https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css as=style onload='this.onload=null,this.rel="stylesheet"'><noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css></noscript><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"Laravel 路由","inLanguage":"zh-cn","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/Joker-desire.github.io\/2023\/05\/learn01\/"},"genre":"posts","keywords":"PHP, Laravel","wordcount":20119,"url":"https:\/\/Joker-desire.github.io\/2023\/05\/learn01\/","datePublished":"2023-05-08T12:43:41+08:00","dateModified":"2023-05-08T12:43:41+08:00","publisher":{"@type":"Organization","name":""},"author":{"@type":"Person","name":"Joker-desire"},"description":""}</script></head><body data-header-desktop=fixed data-header-mobile=auto><script type=text/javascript>(window.localStorage&&localStorage.getItem("theme")?localStorage.getItem("theme")==="dark":"auto"==="auto"?window.matchMedia("(prefers-color-scheme: dark)").matches:"auto"==="dark")&&document.body.setAttribute("theme","dark")</script><div id=mask></div><div class=wrapper><header class=desktop id=header-desktop><div class=header-wrapper><div class=header-title><a href=/ title="Joker-desire's Blog"><span class=header-title-pre><i class='far fa-kiss-wink-heart fa-fw' aria-hidden=true></i></span>welcome</a></div><div class=menu><div class=menu-inner><a class=menu-item href=/posts title=所有文章>所有文章 </a><a class=menu-item href=/categories title=分类>分类 </a><a class=menu-item href=/tags title=标签>标签 </a><a class=menu-item href=/about title=关于>关于 </a><a class=menu-item href=https://github.com/Joker-desire title=GitHub rel="noopener noreffer" target=_blank><i class='fab fa-github fa-fw' aria-hidden=true></i> </a><span class="menu-item delimiter"></span><span class="menu-item search" id=search-desktop>
<input type=text placeholder=搜索文章标题或内容... id=search-input-desktop>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-desktop title=搜索><i class="fas fa-search fa-fw" aria-hidden=true></i>
</a><a href=javascript:void(0); class="search-button search-clear" id=search-clear-desktop title=清空><i class="fas fa-times-circle fa-fw" aria-hidden=true></i>
</a><span class="search-button search-loading" id=search-loading-desktop><i class="fas fa-spinner fa-fw fa-spin" aria-hidden=true></i>
</span></span><a href=javascript:void(0); class="menu-item theme-switch" title=切换主题><i class="fas fa-adjust fa-fw" aria-hidden=true></i></a></div></div></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title="Joker-desire's Blog"><span class=header-title-pre><i class='far fa-kiss-wink-heart fa-fw' aria-hidden=true></i></span>welcome</a></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><div class=menu id=menu-mobile><div class=search-wrapper><div class="search mobile" id=search-mobile><input type=text placeholder=搜索文章标题或内容... id=search-input-mobile>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-mobile title=搜索><i class="fas fa-search fa-fw" aria-hidden=true></i>
</a><a href=javascript:void(0); class="search-button search-clear" id=search-clear-mobile title=清空><i class="fas fa-times-circle fa-fw" aria-hidden=true></i>
</a><span class="search-button search-loading" id=search-loading-mobile><i class="fas fa-spinner fa-fw fa-spin" aria-hidden=true></i></span></div><a href=javascript:void(0); class=search-cancel id=search-cancel-mobile>取消</a></div><a class=menu-item href=/posts title=所有文章>所有文章</a><a class=menu-item href=/categories title=分类>分类</a><a class=menu-item href=/tags title=标签>标签</a><a class=menu-item href=/about title=关于>关于</a><a class=menu-item href=https://github.com/Joker-desire title=GitHub rel="noopener noreffer" target=_blank><i class='fab fa-github fa-fw' aria-hidden=true></i></a><a href=javascript:void(0); class="menu-item theme-switch" title=切换主题>
<i class="fas fa-adjust fa-fw" aria-hidden=true></i></a></div></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><main class=main><div class=container><div class=toc id=toc-auto><h2 class=toc-title>目录</h2><div class=toc-content id=toc-content-auto></div></div><article class="page single"><h1 class="single-title animate__animated animate__flipInX">Laravel 路由</h1><div class=post-meta><div class=post-meta-line><span class=post-author><a href=/ title=Author rel=author class=author><i class="fas fa-user-circle fa-fw" aria-hidden=true></i>Joker-desire</a></span>&nbsp;<span class=post-category>收录于 <a href=/categories/php/><i class="far fa-folder fa-fw" aria-hidden=true></i>PHP</a>&nbsp;<a href=/categories/laravel/><i class="far fa-folder fa-fw" aria-hidden=true></i>Laravel</a></span></div><div class=post-meta-line><i class="far fa-calendar-alt fa-fw" aria-hidden=true></i>&nbsp;<time datetime=2023年05月08日>2023年05月08日</time>&nbsp;<i class="fas fa-pencil-alt fa-fw" aria-hidden=true></i>&nbsp;约 20119 字&nbsp;
<i class="far fa-clock fa-fw" aria-hidden=true></i>&nbsp;预计阅读 41 分钟&nbsp;</div></div><div class="details toc" id=toc-static data-kept><div class="details-summary toc-title"><span>目录</span>
<span><i class="details-icon fas fa-angle-right" aria-hidden=true></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><a href=#基本路由>基本路由</a><ul><li><a href=#基本路由-1>基本路由</a><ul><li><a href=#可用的路由器方法>可用的路由器方法</a></li><li><a href=#依赖注入>依赖注入</a></li></ul></li><li><a href=#重定向路由>重定向路由</a></li><li><a href=#路由列表>路由列表</a></li><li><a href=#路由参数>路由参数</a><ul><li><a href=#必需参数>必需参数</a></li><li><a href=#参数和依赖注入>参数和依赖注入</a></li><li><a href=#可选参数>可选参数</a></li><li><a href=#正则表达式约束>正则表达式约束</a><ul><li><a href=#全局约束条件>全局约束条件</a></li></ul></li><li><a href=#编码的正斜杠>编码的正斜杠</a></li></ul></li><li><a href=#命名路线>命名路线</a><ul><li><a href=#生成命名路由的url>生成命名路由的URL</a></li><li><a href=#检查当前路由>检查当前路由</a></li></ul></li><li><a href=#路由组>路由组</a><ul><li><a href=#路由中间件>路由中间件</a></li><li><a href=#控制器>控制器</a></li><li><a href=#路由前缀>路由前缀</a></li><li><a href=#路由名称前缀>路由名称前缀</a></li></ul></li></ul></li><li><a href=#中间件>中间件</a><ul><li><a href=#定义中间件>定义中间件</a></li><li><a href=#中间件和相应>中间件和相应</a></li><li><a href=#注册中间件>注册中间件</a><ul><li><a href=#全局中间件>全局中间件</a></li><li><a href=#将中间件分配给路由>将中间件分配给路由</a></li><li><a href=#定义中间件别名>定义中间件别名</a></li><li><a href=#排除中间件>排除中间件</a></li><li><a href=#中间件组>中间件组</a></li><li><a href=#排序中间件>排序中间件</a></li><li><a href=#中间件参数>中间件参数</a></li><li><a href=#可终止的中间件>可终止的中间件</a></li></ul></li></ul></li><li><a href=#控制器-1>控制器</a><ul><li><a href=#编写控制器>编写控制器</a><ul><li><a href=#基本控制器>基本控制器</a></li><li><a href=#单动作控制器>单动作控制器</a></li></ul></li><li><a href=#控制器中间件>控制器中间件</a></li><li><a href=#资源控制器>资源控制器</a><ul><li><a href=#自定义缺失模型行为>自定义缺失模型行为</a></li><li><a href=#软删除模型>软删除模型</a></li><li><a href=#指定资源模型>指定资源模型</a></li><li><a href=#生成表单请求>生成表单请求</a></li><li><a href=#部分资源路由>部分资源路由</a></li><li><a href=#api资源路由>API资源路由</a></li><li><a href=#嵌套资源>嵌套资源</a></li><li><a href=#浅层嵌套>浅层嵌套</a></li><li><a href=#命名资源路由>命名资源路由</a></li><li><a href=#命名资源路由参数>命名资源路由参数</a></li><li><a href=#限定范围的资源路由>限定范围的资源路由</a></li><li><a href=#本地化资源uris>本地化资源URIs</a></li><li><a href=#补充资源控制器>补充资源控制器</a></li><li><a href=#单例资源控制器>单例资源控制器</a><ul><li><a href=#creatable单例资源>Creatable单例资源</a></li><li><a href=#api单例资源>API单例资源</a></li></ul></li></ul></li><li><a href=#依赖注入和控制器>依赖注入和控制器</a><ul><li><a href=#构造函数注入>构造函数注入</a></li><li><a href=#方法注入>方法注入</a></li></ul></li></ul></li><li><a href=#http请求>HTTP请求</a><ul><li><a href=#与请求交互>与请求交互</a><ul><li><a href=#访问请求>访问请求</a></li><li><a href=#请求路径主机和方法>请求路径、主机和方法</a><ul><li><a href=#获取请求路径>获取请求路径</a></li><li><a href=#检查请求路径路由信息>检查请求路径/路由信息</a></li><li><a href=#获取请求url>获取请求URL</a></li><li><a href=#获取请求host>获取请求Host</a></li><li><a href=#获取请求方法>获取请求方法</a></li></ul></li><li><a href=#请求头>请求头</a></li><li><a href=#请求ip地址>请求IP地址</a></li><li><a href=#内容协商>内容协商</a></li><li><a href=#psr-7请求>PSR-7请求</a></li></ul></li><li><a href=#输入>输入</a><ul><li><a href=#检索输入>检索输入</a><ul><li><a href=#检索所有输入数据>检索所有输入数据</a></li><li><a href=#检索输入值>检索输入值</a></li><li><a href=#从查询字符串检索输入>从查询字符串检索输入</a></li><li><a href=#检索可字符串化的输入值>检索可字符串化的输入值</a></li><li><a href=#检索布尔值输入>检索布尔值输入</a></li><li><a href=#检索日期输入值>检索日期输入值</a></li><li><a href=#检索枚举输入值>检索枚举输入值</a></li><li><a href=#通过动态属性检索输入>通过动态属性检索输入</a></li><li><a href=#检索输入数据的一部分>检索输入数据的一部分</a></li></ul></li><li><a href=#判断输入是否存在>判断输入是否存在</a></li><li><a href=#合并其他输入>合并其他输入</a></li><li><a href=#旧输入>旧输入</a></li><li><a href=#闪存>闪存</a><ul><li><a href=#闪存输入到session>闪存输入到Session</a></li><li><a href=#闪存输入后重定向>闪存输入后重定向</a></li><li><a href=#检索旧输入值>检索旧输入值</a></li></ul></li><li><a href=#cookies>Cookies</a><ul><li><a href=#检索请求中的cookies>检索请求中的Cookies</a></li></ul></li></ul></li><li><a href=#输入过滤和规范化>输入过滤和规范化</a><ul><li><ul><li><a href=#禁用输入规范化>禁用输入规范化</a></li></ul></li></ul></li><li><a href=#文件>文件</a><ul><li><a href=#检索上传的文件>检索上传的文件</a><ul><li><a href=#验证成功上传的文件>验证成功上传的文件</a></li><li><a href=#文件路径和扩展名>文件路径和扩展名</a></li></ul></li><li><a href=#存储上传的文件>存储上传的文件</a></li></ul></li><li><a href=#配置受信任的代理>配置受信任的代理</a></li><li><a href=#配置可信任的host>配置可信任的Host</a></li></ul></li><li><a href=#响应>响应</a><ul><li><a href=#创建响应>创建响应</a><ul><li><a href=#字符串--数组>字符串 & 数组</a></li><li><a href=#response对象>Response对象</a></li><li><a href=#eloquent模型和集合>Eloquent模型和集合</a></li><li><a href=#添加响应头>添加响应头</a></li><li><a href=#缓存控制中间件>缓存控制中间件</a></li><li><a href=#添加响应cookies>添加响应Cookies</a><ul><li><a href=#生成cookie实例>生成Cookie实例</a></li><li><a href=#提前过期cookies>提前过期Cookies</a></li></ul></li><li><a href=#cookies--加密>Cookies & 加密</a></li></ul></li><li><a href=#重定向>重定向</a><ul><li><a href=#重定向到指定名称的路由>重定向到指定名称的路由</a><ul><li><a href=#通过eloquent模型填充参数>通过Eloquent模型填充参数</a></li></ul></li><li><a href=#重定向到控制器方法>重定向到控制器方法</a></li><li><a href=#重定向到外部域名>重定向到外部域名</a></li><li><a href=#重定向并使用闪存的session数据>重定向并使用闪存的Session数据</a></li></ul></li><li><a href=#其他响应类型>其他响应类型</a><ul><li><a href=#视图响应>视图响应</a></li><li><a href=#json响应>JSON响应</a></li><li><a href=#文件下载>文件下载</a><ul><li><a href=#流式下载>流式下载</a></li></ul></li><li><a href=#文件响应>文件响应</a></li></ul></li><li><a href=#响应宏>响应宏</a></li></ul></li><li><a href=#会话>会话</a><ul><li><a href=#简介>简介</a><ul><li><a href=#配置>配置</a></li><li><a href=#驱动先决条件>驱动先决条件</a><ul><li><a href=#数据库>数据库</a></li><li><a href=#redis>Redis</a></li></ul></li></ul></li><li><a href=#使用session>使用Session</a><ul><li><a href=#获取数据>获取数据</a><ul><li><a href=#全局session助手函数>全局Session助手函数</a></li><li><a href=#获取所有session数据>获取所有Session数据</a></li><li><a href=#判断session里是否存在条目>判断Session里是否存在条目</a></li></ul></li><li><a href=#存储数据>存储数据</a><ul><li><a href=#session存储数组>Session存储数组</a></li><li><a href=#获取删除条目>获取&删除条目</a></li><li><a href=#递增递减会话值>递增、递减会话值</a></li></ul></li><li><a href=#闪存数据>闪存数据</a></li><li><a href=#删除数据>删除数据</a></li><li><a href=#重新生成sessionid>重新生成SessionID</a></li></ul></li><li><a href=#session阻塞>Session阻塞</a></li><li><a href=#添加自定义session驱动>添加自定义Session驱动</a><ul><li><ul><li><a href=#实现驱动>实现驱动</a></li><li><a href=#注册驱动>注册驱动</a></li></ul></li></ul></li></ul></li></ul></nav></div></div><div class=content id=content><h1 id=基本路由>基本路由</h1><h2 id=基本路由-1>基本路由</h2><blockquote><p>最基本的<code>Laravel</code>路由仅接受URI和一个闭包：</p></blockquote><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=nx>Route</span><span class=o>::</span><span class=na>get</span><span class=p>(</span><span class=s2>&#34;foo&#34;</span><span class=p>,</span> <span class=k>function</span> <span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=s1>&#39;Hello PHP&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=可用的路由器方法>可用的路由器方法</h3><blockquote><p>路由器允许注册响应任何HTTP动词的路由</p></blockquote><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=nx>Route</span><span class=o>::</span><span class=na>get</span><span class=p>(</span><span class=nx>uri</span><span class=p>,</span> <span class=nv>$callback</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nx>Route</span><span class=o>::</span><span class=na>post</span><span class=p>(</span><span class=nx>uri</span><span class=p>,</span> <span class=nv>$callback</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nx>Route</span><span class=o>::</span><span class=na>put</span><span class=p>(</span><span class=nx>uri</span><span class=p>,</span> <span class=nv>$callback</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nx>Route</span><span class=o>::</span><span class=na>patch</span><span class=p>(</span><span class=nx>uri</span><span class=p>,</span> <span class=nv>$callback</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nx>Route</span><span class=o>::</span><span class=na>delete</span><span class=p>(</span><span class=nx>uri</span><span class=p>,</span> <span class=nv>$callback</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nx>Route</span><span class=o>::</span><span class=na>options</span><span class=p>(</span><span class=nx>uri</span><span class=p>,</span> <span class=nv>$callback</span><span class=p>);</span>
</span></span></code></pre></td></tr></table></div></div><blockquote><p>在Laravel中可以定义响应多个HTTP动作的路由</p></blockquote><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=sd>/**
</span></span></span><span class=line><span class=cl><span class=sd> * 注册可响应多个HTTP动作的路由
</span></span></span><span class=line><span class=cl><span class=sd> */</span>
</span></span><span class=line><span class=cl><span class=nx>Route</span><span class=o>::</span><span class=na>match</span><span class=p>([</span><span class=s1>&#39;get&#39;</span><span class=p>,</span> <span class=s1>&#39;post&#39;</span><span class=p>],</span> <span class=s1>&#39;match&#39;</span><span class=p>,</span> <span class=k>function</span> <span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=s1>&#39;使用match定义可响应多个HTTP动作的路由&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=sd>/**
</span></span></span><span class=line><span class=cl><span class=sd> * 注册可响应全部HTTP动作的路由
</span></span></span><span class=line><span class=cl><span class=sd> */</span>
</span></span><span class=line><span class=cl><span class=nx>Route</span><span class=o>::</span><span class=na>any</span><span class=p>(</span><span class=s1>&#39;any&#39;</span><span class=p>,</span> <span class=k>function</span> <span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=s1>&#39;使用any定义全部HTTP动作的路由&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=依赖注入>依赖注入</h3><blockquote><p>可以在路由的回调签名中键入提示路由所需要的任何依赖项。</p><p>声明的依赖项将自动解析，并由Laravel服务容器注入回调中。</p></blockquote><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=nx>Route</span><span class=o>::</span><span class=na>get</span><span class=p>(</span><span class=s1>&#39;/api&#39;</span><span class=p>,</span> <span class=k>function</span> <span class=p>(</span><span class=nx>Request</span> <span class=nv>$request</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>Log</span><span class=o>::</span><span class=na>info</span><span class=p>(</span><span class=s2>&#34;api接口请求&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nx>print_r</span><span class=p>(</span><span class=nv>$request</span><span class=o>-&gt;</span><span class=na>all</span><span class=p>());</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=s1>&#39;api接口请求&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=重定向路由>重定向路由</h2><blockquote><p><code>Route::redirect</code>方法提供了一个方便快捷的方式进行重定向到另一个URI的路由</p></blockquote><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=nx>Route</span><span class=o>::</span><span class=na>redirect</span><span class=p>(</span><span class=s1>&#39;/here&#39;</span><span class=p>,</span> <span class=s1>&#39;/api/first&#39;</span><span class=p>);</span>
</span></span></code></pre></td></tr></table></div></div><blockquote><p>默认情况下，返回了<code>302</code>状态码，可以使用可选参数进行自定义状态码</p></blockquote><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=nx>Route</span><span class=o>::</span><span class=na>redirect</span><span class=p>(</span><span class=s1>&#39;/here&#39;</span><span class=p>,</span> <span class=s1>&#39;/api/first&#39;</span><span class=p>,</span> <span class=mi>301</span><span class=p>);</span>
</span></span></code></pre></td></tr></table></div></div><blockquote><p>或者可以使用<code>Route::permanentRedirect</code>，此方法返回<code>301</code>状态码</p></blockquote><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=nx>Route</span><span class=o>::</span><span class=na>permanentRedirect</span><span class=p>(</span><span class=s1>&#39;/here2&#39;</span><span class=p>,</span> <span class=s1>&#39;/api/api&#39;</span><span class=p>);</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=路由列表>路由列表</h2><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=c1># 查看全部路由</span>
</span></span><span class=line><span class=cl>php artisan route:list
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 通过-v选项来显示路由中间件</span>
</span></span><span class=line><span class=cl>php artisan route:list -v
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 通过 --path 选项仅显示给定URI开头的路由</span>
</span></span><span class=line><span class=cl>php artisan route:list --path<span class=o>=</span>api
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 通过 --except-vendor 选项隐藏第三方软件包定义的任何路由</span>
</span></span><span class=line><span class=cl>php artisan route:list --except-vendor
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 通过 --only-vendor 选项只显示第三方软件包定义的任何路由</span>
</span></span><span class=line><span class=cl>php artisan route:list --only-vendor
</span></span></code></pre></td></tr></table></div></div><h2 id=路由参数>路由参数</h2><h3 id=必需参数>必需参数</h3><blockquote><p>在路由中捕获URI的段</p><p>路由参数适中包含在<code>{}</code>大括号中，并应由字母字符组成，下划线<code>_</code>在路由参数名称中也是可以的。</p><p>路由参数根据其顺序注入路由回调/控制器，参数的名称无关紧要。</p></blockquote><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=c1>// 从URL中获取用户ID
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>Route</span><span class=o>::</span><span class=na>get</span><span class=p>(</span><span class=s1>&#39;/user/{id}&#39;</span><span class=p>,</span> <span class=k>function</span> <span class=p>(</span><span class=nx>string</span> <span class=nv>$id</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=s1>&#39;User &#39;</span> <span class=o>.</span> <span class=nv>$id</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// URL：http://127.0.0.1:8000/api/user/1
</span></span></span><span class=line><span class=cl><span class=c1>// 结果：User 1 
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=nx>Route</span><span class=o>::</span><span class=na>get</span><span class=p>(</span><span class=s1>&#39;/posts/{post}/comments/{comment}&#39;</span><span class=p>,</span> <span class=k>function</span> <span class=p>(</span><span class=nx>string</span> <span class=nv>$postId</span><span class=p>,</span> <span class=nx>string</span> <span class=nv>$commentId</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=s1>&#39;Post id -&gt; &#39;</span> <span class=o>.</span> <span class=nv>$postId</span> <span class=o>.</span> <span class=s1>&#39; Comment id -&gt; &#39;</span> <span class=o>.</span> <span class=nv>$commentId</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span><span class=line><span class=cl><span class=c1>// url: http://127.0.0.1:8000/api/posts/1001/comments/3000
</span></span></span><span class=line><span class=cl><span class=c1>// 结果：Post id -&gt; 1001 Comment id -&gt; 3000
</span></span></span></code></pre></td></tr></table></div></div><h3 id=参数和依赖注入>参数和依赖注入</h3><blockquote><p>如果路由具有依赖项，并希望Laravel服务容器自动注入路由的回调中，应该在依赖项之后列出路由参数</p></blockquote><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=k>use</span> <span class=nx>Illuminate\Http\Request</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>Route</span><span class=o>::</span><span class=na>get</span><span class=p>(</span><span class=s1>&#39;/user/{id}&#39;</span><span class=p>,</span> <span class=k>function</span> <span class=p>(</span><span class=nx>Request</span> <span class=nv>$request</span><span class=p>,</span> <span class=nx>string</span> <span class=nv>$id</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=s1>&#39;User &#39;</span> <span class=o>.</span> <span class=nv>$id</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=可选参数>可选参数</h3><blockquote><p>通过放置一个<code>?</code>在参数名称后标记，则可设置一个可选参数。</p><p>注：确保给路由的相应变量一个默认值。</p></blockquote><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=nx>Route</span><span class=o>::</span><span class=na>get</span><span class=p>(</span><span class=s1>&#39;/user/{name?}&#39;</span><span class=p>,</span> <span class=k>function</span> <span class=p>(</span><span class=nx>string</span> <span class=nv>$name</span> <span class=o>=</span> <span class=k>null</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nv>$name</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>Route</span><span class=o>::</span><span class=na>get</span><span class=p>(</span><span class=s1>&#39;/user/{name?}&#39;</span><span class=p>,</span> <span class=k>function</span> <span class=p>(</span><span class=nx>string</span> <span class=nv>$name</span> <span class=o>=</span> <span class=s1>&#39;Joker&#39;</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nv>$name</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=正则表达式约束>正则表达式约束</h3><blockquote><p>使用路由实例上的<code>where</code>方法限制路由参数的格式</p><p><code>where</code>方法接受参数的名称和定义如何约束参数的正则表达式</p><p>如果传入的请求与路由模式约束不匹配，将返回<code>404</code>HTTP响应</p></blockquote><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=nx>Route</span><span class=o>::</span><span class=na>get</span><span class=p>(</span><span class=s1>&#39;/user/{name}&#39;</span><span class=p>,</span> <span class=k>function</span> <span class=p>(</span><span class=nx>string</span> <span class=nv>$name</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>})</span><span class=o>-&gt;</span><span class=na>where</span><span class=p>(</span><span class=s1>&#39;name&#39;</span><span class=p>,</span> <span class=s1>&#39;[A-Za-z]+&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>Route</span><span class=o>::</span><span class=na>get</span><span class=p>(</span><span class=s1>&#39;/user/{id}&#39;</span><span class=p>,</span> <span class=k>function</span> <span class=p>(</span><span class=nx>int</span> <span class=nv>$id</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>//...
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>})</span><span class=o>-&gt;</span><span class=na>where</span><span class=p>(</span><span class=s1>&#39;id&#39;</span><span class=p>,</span> <span class=s1>&#39;[0-9]+&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>Route</span><span class=o>::</span><span class=na>get</span><span class=p>(</span><span class=s1>&#39;/user/{id}/{name}&#39;</span><span class=p>,</span> <span class=k>function</span> <span class=p>(</span><span class=nx>int</span> <span class=nv>$id</span><span class=p>,</span> <span class=nx>string</span> <span class=nv>$name</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>})</span><span class=o>-&gt;</span><span class=na>where</span><span class=p>([</span><span class=s1>&#39;id&#39;</span> <span class=o>=&gt;</span> <span class=s1>&#39;[0-9]+&#39;</span><span class=p>,</span> <span class=s1>&#39;name&#39;</span> <span class=o>=&gt;</span> <span class=s1>&#39;[A-Za-z]+&#39;</span><span class=p>]);</span>
</span></span></code></pre></td></tr></table></div></div><blockquote><p>为了方便起见，一些常用的正则表达式具有辅助方法，允许快速向路由添加模式约束</p></blockquote><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=sd>/**
</span></span></span><span class=line><span class=cl><span class=sd> * whereAlphaNumeric: 指定给定的路由参数必须是字母数字
</span></span></span><span class=line><span class=cl><span class=sd> */</span>
</span></span><span class=line><span class=cl><span class=nx>Route</span><span class=o>::</span><span class=na>get</span><span class=p>(</span><span class=s1>&#39;/user/{name}&#39;</span><span class=p>,</span> <span class=k>function</span> <span class=p>(</span><span class=nx>string</span> <span class=nv>$name</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>})</span><span class=o>-&gt;</span><span class=na>whereAlphaNumeric</span><span class=p>(</span><span class=s1>&#39;name&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=sd>/**
</span></span></span><span class=line><span class=cl><span class=sd> * whereNumber: 指定给定的路由参数必须是数字
</span></span></span><span class=line><span class=cl><span class=sd> */</span>
</span></span><span class=line><span class=cl><span class=nx>Route</span><span class=o>::</span><span class=na>get</span><span class=p>(</span><span class=s1>&#39;/user/{id}&#39;</span><span class=p>,</span> <span class=k>function</span> <span class=p>(</span><span class=nx>int</span> <span class=nv>$id</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>//...
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>})</span><span class=o>-&gt;</span><span class=na>whereNumber</span><span class=p>(</span><span class=s1>&#39;id&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=sd>/**
</span></span></span><span class=line><span class=cl><span class=sd> * 使用多个参数约束条件
</span></span></span><span class=line><span class=cl><span class=sd> */</span>
</span></span><span class=line><span class=cl><span class=nx>Route</span><span class=o>::</span><span class=na>get</span><span class=p>(</span><span class=s1>&#39;/user/{id}/{name}&#39;</span><span class=p>,</span> <span class=k>function</span> <span class=p>(</span><span class=nx>int</span> <span class=nv>$id</span><span class=p>,</span> <span class=nx>string</span> <span class=nv>$name</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>})</span><span class=o>-&gt;</span><span class=na>whereNumber</span><span class=p>(</span><span class=s1>&#39;id&#39;</span><span class=p>)</span><span class=o>-&gt;</span><span class=na>whereAlpha</span><span class=p>(</span><span class=s1>&#39;name&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=sd>/**
</span></span></span><span class=line><span class=cl><span class=sd> * whereUuid: 指定给定的路由参数必须是UUlDs。
</span></span></span><span class=line><span class=cl><span class=sd> */</span>
</span></span><span class=line><span class=cl><span class=nx>Route</span><span class=o>::</span><span class=na>get</span><span class=p>(</span><span class=s1>&#39;/user/{id}&#39;</span><span class=p>,</span> <span class=k>function</span> <span class=p>(</span><span class=nx>string</span> <span class=nv>$id</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>})</span><span class=o>-&gt;</span><span class=na>whereUuid</span><span class=p>(</span><span class=s1>&#39;id&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=sd>/**
</span></span></span><span class=line><span class=cl><span class=sd> * whereUlid: 指定给定的路由参数必须是ULIDs。
</span></span></span><span class=line><span class=cl><span class=sd> */</span>
</span></span><span class=line><span class=cl><span class=nx>Route</span><span class=o>::</span><span class=na>get</span><span class=p>(</span><span class=s1>&#39;/user/{id}&#39;</span><span class=p>,</span> <span class=k>function</span> <span class=p>(</span><span class=nx>string</span> <span class=nv>$id</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>})</span><span class=o>-&gt;</span><span class=na>whereUlid</span><span class=p>(</span><span class=s1>&#39;id&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=sd>/**
</span></span></span><span class=line><span class=cl><span class=sd> * whereIn: 指定给定的路由参数必须是给定值之一
</span></span></span><span class=line><span class=cl><span class=sd> */</span>
</span></span><span class=line><span class=cl><span class=nx>Route</span><span class=o>::</span><span class=na>get</span><span class=p>(</span><span class=s1>&#39;/category/{category}&#39;</span><span class=p>,</span> <span class=k>function</span> <span class=p>(</span><span class=nx>string</span> <span class=nv>$category</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>})</span><span class=o>-&gt;</span><span class=na>whereIn</span><span class=p>(</span><span class=s1>&#39;category&#39;</span><span class=p>,</span> <span class=p>[</span><span class=s1>&#39;movie&#39;</span><span class=p>,</span> <span class=s1>&#39;song&#39;</span><span class=p>,</span> <span class=s1>&#39;painting&#39;</span><span class=p>]);</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=全局约束条件>全局约束条件</h4><blockquote><p>使用<code>patten</code>方法可以定义全局约束条件。</p><p>在<code>app/Providers/RouteServiceProvider.php</code>文件中的<code>RouteServiceProvider</code>类的<code>boot</code>方法中定义这些全局约束条件模式</p></blockquote><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=k>public</span> <span class=k>function</span> <span class=nf>boot</span><span class=p>()</span><span class=o>:</span> <span class=nx>void</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// 定义全局约束条件
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=nx>Route</span><span class=o>::</span><span class=na>pattern</span><span class=p>(</span><span class=s1>&#39;id&#39;</span><span class=p>,</span> <span class=s1>&#39;[0-9]+&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><blockquote><p>一旦定义了全局模式，将使用参数名称的自动应用于所有路由</p></blockquote><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=nx>Route</span><span class=o>::</span><span class=na>get</span><span class=p>(</span><span class=s1>&#39;/user/{id}&#39;</span><span class=p>,</span> <span class=k>function</span> <span class=p>(</span><span class=nx>string</span> <span class=nv>$id</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=s1>&#39;userid -&gt; &#39;</span> <span class=o>.</span> <span class=nv>$id</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=编码的正斜杠>编码的正斜杠</h3><blockquote><p><code>Laravel</code>路由组件允许除<code>/</code>之外的所有字符都在存在于路由参数值中。</p><p>必须使用<code>where</code>条件正则表达式明确允许<code>/</code>成为占位符的一部分。</p><p>注：编码的正斜杠仅在最后一个路由段内受支持。</p></blockquote><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=nx>Route</span><span class=o>::</span><span class=na>get</span><span class=p>(</span><span class=s1>&#39;/search/{search}&#39;</span><span class=p>,</span> <span class=k>function</span> <span class=p>(</span><span class=nx>string</span> <span class=nv>$search</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=s1>&#39;Search -&gt; &#39;</span> <span class=o>.</span> <span class=nv>$search</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>})</span><span class=o>-&gt;</span><span class=na>where</span><span class=p>(</span><span class=s1>&#39;search&#39;</span><span class=p>,</span> <span class=s1>&#39;.*&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// URL：http://127.0.0.1:8000/api/search/Joker/19/Shenzhen
</span></span></span><span class=line><span class=cl><span class=c1>// 结果：Search -&gt; Joker/19/Shenzhen
</span></span></span></code></pre></td></tr></table></div></div><h2 id=命名路线>命名路线</h2><blockquote><p>命名路由允许为特定路由方便地生成URL或重定向。</p><p>通过<code>name</code>方法链接到路由定义上，可以指定路由的名称。</p><p>注：路由名称应始终是唯一的。</p></blockquote><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=nx>Route</span><span class=o>::</span><span class=na>get</span><span class=p>(</span><span class=s1>&#39;/user/profile&#39;</span><span class=p>,</span> <span class=k>function</span> <span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>})</span><span class=o>-&gt;</span><span class=na>name</span><span class=p>(</span><span class=s1>&#39;profile&#39;</span><span class=p>);</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=生成命名路由的url>生成命名路由的URL</h3><p>一旦为给定的路由分配一个名字，可以通过<code>Laravel</code>的<code>route</code>和<code>redirect</code>辅助函数生成URL或重定向时使用该路由的名称：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=nx>Route</span><span class=o>::</span><span class=na>get</span><span class=p>(</span><span class=s1>&#39;/user/create&#39;</span><span class=p>,</span> <span class=k>function</span> <span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 生成完整的URL
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nv>$url</span> <span class=o>=</span> <span class=nx>route</span><span class=p>(</span><span class=s1>&#39;profile&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nx>log</span><span class=o>::</span><span class=na>debug</span><span class=p>(</span><span class=nv>$url</span><span class=p>)</span> <span class=c1>// http://127.0.0.1:8000/api/user/profile
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=c1>// 生成重定向(两种方式)
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=c1>// return redirect()-&gt;route(&#39;profile&#39;);
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>return</span> <span class=nx>to_route</span><span class=p>(</span><span class=s1>&#39;profile&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span></code></pre></td></tr></table></div></div><p>如果命名路由定义了参数，可以将参数作为第二个参数传递给<code>route</code>函数。给定的参数将自动插入到生成的URL的正确位置：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=nx>Route</span><span class=o>::</span><span class=na>get</span><span class=p>(</span><span class=s1>&#39;/user/{id}/profile&#39;</span><span class=p>,</span> <span class=k>function</span> <span class=p>(</span><span class=nx>string</span> <span class=nv>$id</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>})</span><span class=o>-&gt;</span><span class=na>name</span><span class=p>(</span><span class=s1>&#39;profile&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 生成完整的URL
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nv>$url</span> <span class=o>=</span> <span class=nx>route</span><span class=p>(</span><span class=s1>&#39;profile&#39;</span><span class=p>,</span> <span class=p>[</span><span class=s1>&#39;id&#39;</span> <span class=o>=&gt;</span> <span class=mi>1</span><span class=p>]);</span>
</span></span><span class=line><span class=cl><span class=nx>log</span><span class=o>::</span><span class=na>debug</span><span class=p>(</span><span class=nv>$url</span><span class=p>);</span> <span class=c1>// http://127.0.0.1:8000/api/user/1/profile
</span></span></span></code></pre></td></tr></table></div></div><p>如果在数组中传递其他参数，这些键值对将自动添加到生成的URL的查询字符串中：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=nv>$url</span> <span class=o>=</span> <span class=nx>route</span><span class=p>(</span><span class=s1>&#39;profile&#39;</span><span class=p>,</span> <span class=p>[</span><span class=s1>&#39;id&#39;</span> <span class=o>=&gt;</span> <span class=mi>1</span><span class=p>,</span> <span class=s1>&#39;photos&#39;</span> <span class=o>=&gt;</span> <span class=s1>&#39;yes&#39;</span><span class=p>]);</span>
</span></span><span class=line><span class=cl><span class=nx>log</span><span class=o>::</span><span class=na>debug</span><span class=p>(</span><span class=nv>$url</span><span class=p>);</span> <span class=c1>// http://127.0.0.1:8000/api/user/1/profile?photos=yes
</span></span></span></code></pre></td></tr></table></div></div><h3 id=检查当前路由>检查当前路由</h3><p>如果想确定当前请求是否路由到给定的命名路由，可以在<code>Route</code>实例上使用<code>named</code>方法。例如，可以在路由中间件检查当前路由名称：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=k>if</span> <span class=p>(</span><span class=nv>$request</span><span class=o>-&gt;</span><span class=na>route</span><span class=p>()</span><span class=o>-&gt;</span><span class=na>named</span><span class=p>(</span><span class=s1>&#39;profile&#39;</span><span class=p>)){</span>
</span></span><span class=line><span class=cl>    <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=路由组>路由组</h2><p>路由组允许共享路由属性。例如中间件，而无需在每个独立的路由上定义这些属性。</p><p>嵌套组尝试智能地将属性与其父组"合并"。中间件和<code>where</code>条件合并，同时附加名称和前缀。URL前缀中的命名空间分隔符和斜杠会在适当的地方自动添加。</p><h3 id=路由中间件>路由中间件</h3><blockquote><p>要将中间件分配给组内的所有路由，可以在定义组之前使用<code>middleware</code>方法。</p><p>中间件按照它们在数组中列出的顺序执行</p></blockquote><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=nx>Route</span><span class=o>::</span><span class=na>middleware</span><span class=p>([</span><span class=s1>&#39;first&#39;</span><span class=p>,</span> <span class=s1>&#39;second&#39;</span><span class=p>])</span><span class=o>-&gt;</span><span class=na>group</span><span class=p>(</span><span class=k>function</span> <span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>Route</span><span class=o>::</span><span class=na>get</span><span class=p>(</span><span class=s1>&#39;/&#39;</span><span class=p>,</span> <span class=k>function</span> <span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=p>});</span>
</span></span><span class=line><span class=cl>    <span class=nx>Route</span><span class=o>::</span><span class=na>get</span><span class=p>(</span><span class=s1>&#39;/user/profile&#39;</span><span class=p>,</span> <span class=k>function</span> <span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=p>});</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=控制器>控制器</h3><blockquote><p>如果一组路由都使用相同的控制器，可以使用<code>controller</code>方法为组内的所有路由定义公共控制器。然后再定义路由时，只需要提供他们调用的控制器方法</p></blockquote><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=k>use</span> <span class=nx>\App\Http\Controllers\Api\OrderController</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>Route</span><span class=o>::</span><span class=na>controller</span><span class=p>(</span><span class=nx>OrderController</span><span class=o>::</span><span class=na>class</span><span class=p>)</span><span class=o>-&gt;</span><span class=na>group</span><span class=p>(</span><span class=k>function</span> <span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>Route</span><span class=o>::</span><span class=na>get</span><span class=p>(</span><span class=s1>&#39;/order/{id}&#39;</span><span class=p>,</span> <span class=s1>&#39;show&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nx>Route</span><span class=o>::</span><span class=na>get</span><span class=p>(</span><span class=s1>&#39;/orders&#39;</span><span class=p>,</span> <span class=s1>&#39;store&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=路由前缀>路由前缀</h3><blockquote><p><code>prefix</code>方法可以用给定的URI为组中的每个路由做前缀。</p></blockquote><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=nx>Route</span><span class=o>::</span><span class=na>prefix</span><span class=p>(</span><span class=s1>&#39;admin&#39;</span><span class=p>)</span><span class=o>-&gt;</span><span class=na>group</span><span class=p>(</span><span class=k>function</span> <span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>Route</span><span class=o>::</span><span class=na>get</span><span class=p>(</span><span class=s1>&#39;/users&#39;</span><span class=p>,</span> <span class=k>function</span> <span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// 对应 &#39;/admin/users&#39; 的URL
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=p>});</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=路由名称前缀>路由名称前缀</h3><blockquote><p><code>name</code>方法可以给定字符串作为组中的每个路由名的前缀</p><p>建议要提供末尾<code>.</code>字符在前缀中</p></blockquote><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=nx>Route</span><span class=o>::</span><span class=na>name</span><span class=p>(</span><span class=s1>&#39;admin.&#39;</span><span class=p>)</span><span class=o>-&gt;</span><span class=na>group</span><span class=p>(</span><span class=k>function</span> <span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>Route</span><span class=o>::</span><span class=na>get</span><span class=p>(</span><span class=s1>&#39;/users&#39;</span><span class=p>,</span> <span class=k>function</span> <span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// 被分配的路由名为：&#39;admin.users&#39;
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=p>})</span><span class=o>-&gt;</span><span class=na>name</span><span class=p>(</span><span class=s1>&#39;users&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span></code></pre></td></tr></table></div></div><h1 id=中间件>中间件</h1><h2 id=定义中间件>定义中间件</h2><blockquote><p>可以使用<code>make:middleware</code> Artisan命令</p></blockquote><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>php artisan make:middleware EnsureTokenIsValid
</span></span></code></pre></td></tr></table></div></div><p>此命令将在项目的 <code>app/Http/Middleware</code> 目录中放置一个新的 <code>EnsureTokenIsValid</code> 类。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=o>&lt;?</span><span class=nx>php</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>namespace</span> <span class=nx>App\Http\Middleware</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>use</span> <span class=nx>Closure</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>use</span> <span class=nx>Illuminate\Http\Request</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>use</span> <span class=nx>Symfony\Component\HttpFoundation\Response</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>EnsureTokenIsValid</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=sd>/**
</span></span></span><span class=line><span class=cl><span class=sd>     * Handle an incoming request.
</span></span></span><span class=line><span class=cl><span class=sd>     *
</span></span></span><span class=line><span class=cl><span class=sd>     * @param  \Closure(\Illuminate\Http\Request): (\Symfony\Component\HttpFoundation\Response)  $next
</span></span></span><span class=line><span class=cl><span class=sd>     */</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=nf>handle</span><span class=p>(</span><span class=nx>Request</span> <span class=nv>$request</span><span class=p>,</span> <span class=nx>Closure</span> <span class=nv>$next</span><span class=p>)</span><span class=o>:</span> <span class=nx>Response</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// 判断传入的token是否一致
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=k>if</span> <span class=p>(</span><span class=nv>$request</span><span class=o>-&gt;</span><span class=na>input</span><span class=p>(</span><span class=s1>&#39;token&#39;</span><span class=p>)</span> <span class=o>!==</span> <span class=s1>&#39;my-secret-token&#39;</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=nx>redirect</span><span class=p>(</span><span class=s1>&#39;home&#39;</span><span class=p>)</span> <span class=c1>// 如果不一致，则重定向到home路由
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nv>$next</span><span class=p>(</span><span class=nv>$request</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=中间件和相应>中间件和相应</h2><blockquote><p>中间件可以在请求更深入地传递到应用程序之前或之后执行任务</p></blockquote><p><strong>请求之前执行任务</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=o>&lt;?</span><span class=nx>php</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>namespace</span> <span class=nx>App\Http\Middleware</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>use</span> <span class=nx>Closure</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>use</span> <span class=nx>Illuminate\Http\Request</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>use</span> <span class=nx>Symfony\Component\HttpFoundation\Response</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>BeforeMiddleware</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=sd>/**
</span></span></span><span class=line><span class=cl><span class=sd>     * Handle an incoming request.
</span></span></span><span class=line><span class=cl><span class=sd>     *
</span></span></span><span class=line><span class=cl><span class=sd>     * @param \Closure(\Illuminate\Http\Request): (\Symfony\Component\HttpFoundation\Response) $next
</span></span></span><span class=line><span class=cl><span class=sd>     */</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=nf>handle</span><span class=p>(</span><span class=nx>Request</span> <span class=nv>$request</span><span class=p>,</span> <span class=nx>Closure</span> <span class=nv>$next</span><span class=p>)</span><span class=o>:</span> <span class=nx>Response</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// 执行操作
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=k>return</span> <span class=nv>$next</span><span class=p>(</span><span class=nv>$request</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>请求后执行任务</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=o>&lt;?</span><span class=nx>php</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>namespace</span> <span class=nx>App\Http\Middleware</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>use</span> <span class=nx>Closure</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>use</span> <span class=nx>Illuminate\Http\Request</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>use</span> <span class=nx>Symfony\Component\HttpFoundation\Response</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>AfterMiddleware</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=sd>/**
</span></span></span><span class=line><span class=cl><span class=sd>     * Handle an incoming request.
</span></span></span><span class=line><span class=cl><span class=sd>     *
</span></span></span><span class=line><span class=cl><span class=sd>     * @param \Closure(\Illuminate\Http\Request): (\Symfony\Component\HttpFoundation\Response) $next
</span></span></span><span class=line><span class=cl><span class=sd>     */</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=nf>handle</span><span class=p>(</span><span class=nx>Request</span> <span class=nv>$request</span><span class=p>,</span> <span class=nx>Closure</span> <span class=nv>$next</span><span class=p>)</span><span class=o>:</span> <span class=nx>Response</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nv>$response</span> <span class=o>=</span> <span class=nv>$next</span><span class=p>(</span><span class=nv>$request</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1>// 执行操作
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nv>$response</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=注册中间件>注册中间件</h2><h3 id=全局中间件>全局中间件</h3><blockquote><p>如果希望在对应程序的每个HTTP请求期间运行中间件，需要在<code>app/Http/Kernel.php</code>类的<code>$middleware</code>属性中列出中间件类。</p></blockquote><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=k>class</span> <span class=nc>Kernel</span> <span class=k>extends</span> <span class=nx>HttpKernel</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=sd>/**
</span></span></span><span class=line><span class=cl><span class=sd>     * The application&#39;s global HTTP middleware stack.
</span></span></span><span class=line><span class=cl><span class=sd>     *
</span></span></span><span class=line><span class=cl><span class=sd>     * These middleware are run during every request to your application.
</span></span></span><span class=line><span class=cl><span class=sd>     *
</span></span></span><span class=line><span class=cl><span class=sd>     * @var array&lt;int, class-string|string&gt;
</span></span></span><span class=line><span class=cl><span class=sd>     */</span>
</span></span><span class=line><span class=cl>    <span class=k>protected</span> <span class=nv>$middleware</span> <span class=o>=</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>        <span class=c1>// \App\Http\Middleware\TrustHosts::class,
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=nx>\App\Http\Middleware\TrustProxies</span><span class=o>::</span><span class=na>class</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>\Illuminate\Http\Middleware\HandleCors</span><span class=o>::</span><span class=na>class</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>\App\Http\Middleware\PreventRequestsDuringMaintenance</span><span class=o>::</span><span class=na>class</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>\Illuminate\Foundation\Http\Middleware\ValidatePostSize</span><span class=o>::</span><span class=na>class</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>\App\Http\Middleware\TrimStrings</span><span class=o>::</span><span class=na>class</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>\Illuminate\Foundation\Http\Middleware\ConvertEmptyStringsToNull</span><span class=o>::</span><span class=na>class</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>];</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=将中间件分配给路由>将中间件分配给路由</h3><blockquote><p>如果要将中间件分配给特定路由，可以在定义路由时调用<code>middleware</code>方法</p></blockquote><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=k>use</span> <span class=nx>\App\Http\Middleware\BeforeMiddleware</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>Route</span><span class=o>::</span><span class=na>get</span><span class=p>(</span><span class=s1>&#39;/profile&#39;</span><span class=p>,</span> <span class=k>function</span> <span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>})</span><span class=o>-&gt;</span><span class=na>middleware</span><span class=p>(</span><span class=nx>BeforeMiddleware</span><span class=o>::</span><span class=na>class</span><span class=p>);</span>
</span></span></code></pre></td></tr></table></div></div><blockquote><p>通过向<code>middleware</code>方法传递一组中间件名称，可以为路由分配多个中间件</p></blockquote><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=k>use</span> <span class=nx>\App\Http\Middleware\BeforeMiddleware</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>use</span> <span class=nx>\App\Http\Middleware\AfterMiddleware</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>Route</span><span class=o>::</span><span class=na>get</span><span class=p>(</span><span class=s1>&#39;/profile&#39;</span><span class=p>,</span> <span class=k>function</span> <span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>})</span><span class=o>-&gt;</span><span class=na>middleware</span><span class=p>([</span><span class=nx>BeforeMiddleware</span><span class=o>::</span><span class=na>class</span><span class=p>,</span> <span class=nx>AfterMiddleware</span><span class=o>::</span><span class=na>class</span><span class=p>]);</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=定义中间件别名>定义中间件别名</h3><blockquote><p>为了方便起见，可以在应用程序的<code>app/Http/Kernel.php</code>文件中为中间件分配别名</p></blockquote><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=k>protected</span> <span class=nv>$middlewareAliases</span> <span class=o>=</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>    <span class=o>...</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 自定义中间价
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=s1>&#39;before&#39;</span> <span class=o>=&gt;</span> <span class=nx>\App\Http\Middleware\BeforeMiddleware</span><span class=o>::</span><span class=na>class</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;after&#39;</span> <span class=o>=&gt;</span> <span class=nx>\App\Http\Middleware\AfterMiddleware</span><span class=o>::</span><span class=na>class</span>
</span></span><span class=line><span class=cl><span class=p>];</span>
</span></span></code></pre></td></tr></table></div></div><p>在路由中使用中间件分配的别名</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=nx>Route</span><span class=o>::</span><span class=na>get</span><span class=p>(</span><span class=s1>&#39;/profile&#39;</span><span class=p>,</span> <span class=k>function</span> <span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>})</span><span class=o>-&gt;</span><span class=na>middleware</span><span class=p>([</span><span class=s1>&#39;before&#39;</span><span class=p>,</span> <span class=s1>&#39;after&#39;</span><span class=p>]);</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=排除中间件>排除中间件</h3><blockquote><p>当将中间件分配给一组路由时，可能偶尔需要防止中间件应用于组内的单个路由。</p><p>可以使用<code>withoutMiddleware</code>方法完成此操作。</p></blockquote><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>use \App\Http\Middleware\EnsureTokenIsValid;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Route::middleware([EnsureTokenIsValid::class])-&gt;group(function () {
</span></span><span class=line><span class=cl>    Route::get(&#39;/&#39;, function () {
</span></span><span class=line><span class=cl>        // ...
</span></span><span class=line><span class=cl>    });
</span></span><span class=line><span class=cl>    Route::get(&#39;/profile&#39;, function () {
</span></span><span class=line><span class=cl>        // ...
</span></span><span class=line><span class=cl>    })-&gt;withoutMiddleware([EnsureTokenIsValid::class]);
</span></span><span class=line><span class=cl>});
</span></span></code></pre></td></tr></table></div></div><blockquote><p>也可以从整个组路由定义中排除一组给定的中间件</p></blockquote><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=k>use</span> <span class=nx>\App\Http\Middleware\EnsureTokenIsValid</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>Route</span><span class=o>::</span><span class=na>middleware</span><span class=p>([</span><span class=nx>EnsureTokenIsValid</span><span class=o>::</span><span class=na>class</span><span class=p>])</span><span class=o>-&gt;</span><span class=na>group</span><span class=p>(</span><span class=k>function</span> <span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>Route</span><span class=o>::</span><span class=na>get</span><span class=p>(</span><span class=s1>&#39;/&#39;</span><span class=p>,</span> <span class=k>function</span> <span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=p>});</span>
</span></span><span class=line><span class=cl>    <span class=nx>Route</span><span class=o>::</span><span class=na>withoutMiddleware</span><span class=p>([</span><span class=nx>EnsureTokenIsValid</span><span class=o>::</span><span class=na>class</span><span class=p>])</span><span class=o>-&gt;</span><span class=na>group</span><span class=p>(</span><span class=k>function</span> <span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>Route</span><span class=o>::</span><span class=na>get</span><span class=p>(</span><span class=s1>&#39;/login&#39;</span><span class=p>,</span> <span class=k>function</span> <span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=p>});</span>
</span></span><span class=line><span class=cl>    <span class=p>});</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=中间件组>中间件组</h3><blockquote><p>如果希望将多个中间件组合在一个键下，以使它们更容易分配给路由。可以使用HTTP内核的<code>$middlewareGroups</code>属性来完成此操作。</p><p>Laravel包括预定义带有<code>web</code>和<code>api</code>中间件组，其中包含肯呢个希望应用于web和api路由的常见中间件。这些中间件组会由应用程序的<code>App\Providers\RouteServiceProvider</code>服务提供者自动应用于相应的<code>web</code>和<code>api</code>路由文件中的路由</p></blockquote><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=sd>/**
</span></span></span><span class=line><span class=cl><span class=sd> * The application&#39;s route middleware groups.
</span></span></span><span class=line><span class=cl><span class=sd> *
</span></span></span><span class=line><span class=cl><span class=sd> * @var array&lt;string, array&lt;int, class-string|string&gt;&gt;
</span></span></span><span class=line><span class=cl><span class=sd> */</span>
</span></span><span class=line><span class=cl><span class=k>protected</span> <span class=nv>$middlewareGroups</span> <span class=o>=</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;web&#39;</span> <span class=o>=&gt;</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>        <span class=nx>\App\Http\Middleware\EncryptCookies</span><span class=o>::</span><span class=na>class</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>\Illuminate\Cookie\Middleware\AddQueuedCookiesToResponse</span><span class=o>::</span><span class=na>class</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>\Illuminate\Session\Middleware\StartSession</span><span class=o>::</span><span class=na>class</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>\Illuminate\View\Middleware\ShareErrorsFromSession</span><span class=o>::</span><span class=na>class</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=c1>//            \App\Http\Middleware\VerifyCsrfToken::class,
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=nx>\Illuminate\Routing\Middleware\SubstituteBindings</span><span class=o>::</span><span class=na>class</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>],</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;api&#39;</span> <span class=o>=&gt;</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>        <span class=c1>// \Laravel\Sanctum\Http\Middleware\EnsureFrontendRequestsAreStateful::class,
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=nx>\Illuminate\Routing\Middleware\ThrottleRequests</span><span class=o>::</span><span class=na>class</span> <span class=o>.</span> <span class=s1>&#39;:api&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>\Illuminate\Routing\Middleware\SubstituteBindings</span><span class=o>::</span><span class=na>class</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>],</span>
</span></span><span class=line><span class=cl><span class=p>];</span>
</span></span></code></pre></td></tr></table></div></div><blockquote><p>中间件组可以使用与单个中间件相同的语法分配给路由和控制器动作。同理，中间件组使一次将多个中间件分配给一个路由更加方便</p></blockquote><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=nx>Route</span><span class=o>::</span><span class=na>get</span><span class=p>(</span><span class=s1>&#39;/&#39;</span><span class=p>,</span> <span class=k>function</span> <span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>})</span><span class=o>-&gt;</span><span class=na>middleware</span><span class=p>(</span><span class=s1>&#39;web&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>Route</span><span class=o>::</span><span class=na>middleware</span><span class=p>([</span><span class=s1>&#39;web&#39;</span><span class=p>])</span><span class=o>-&gt;</span><span class=na>group</span><span class=p>(</span><span class=k>function</span> <span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>});</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=排序中间件>排序中间件</h3><blockquote><p>在特定情况下，可能需要中间件以特定的顺序执行，但当它们分配到路由时，是无法控制它们的顺序的。这种情况下，可以使用到<code>app/Http/Kernel.php</code>文件的<code>$middlewarePriority</code>属性指定中间件优先级。</p><p>注：默认情况下，HTTP内核中可能不存在此属性。如果不存在则新增即可。</p></blockquote><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=sd>/**
</span></span></span><span class=line><span class=cl><span class=sd> * 中间件的优先级排序列表
</span></span></span><span class=line><span class=cl><span class=sd> *
</span></span></span><span class=line><span class=cl><span class=sd> * 这迫使非全局中间件始终处于给定的顺序
</span></span></span><span class=line><span class=cl><span class=sd> *
</span></span></span><span class=line><span class=cl><span class=sd> * @var string[]
</span></span></span><span class=line><span class=cl><span class=sd> */</span>
</span></span><span class=line><span class=cl><span class=k>protected</span> <span class=nv>$middlewarePriority</span> <span class=o>=</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>    <span class=nx>\Illuminate\Foundation\Http\Middleware\HandlePrecognitiveRequests</span><span class=o>::</span><span class=na>class</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>\Illuminate\Cookie\Middleware\EncryptCookies</span><span class=o>::</span><span class=na>class</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>\Illuminate\Session\Middleware\StartSession</span><span class=o>::</span><span class=na>class</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>\Illuminate\View\Middleware\ShareErrorsFromSession</span><span class=o>::</span><span class=na>class</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>\Illuminate\Contracts\Auth\Middleware\AuthenticatesRequests</span><span class=o>::</span><span class=na>class</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>\Illuminate\Routing\Middleware\ThrottleRequests</span><span class=o>::</span><span class=na>class</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>\Illuminate\Routing\Middleware\ThrottleRequestsWithRedis</span><span class=o>::</span><span class=na>class</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>\Illuminate\Contracts\Session\Middleware\AuthenticatesSessions</span><span class=o>::</span><span class=na>class</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>\Illuminate\Routing\Middleware\SubstituteBindings</span><span class=o>::</span><span class=na>class</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>\Illuminate\Auth\Middleware\Authorize</span><span class=o>::</span><span class=na>class</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=p>];</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=中间件参数>中间件参数</h3><blockquote><p>中间件也可以接收额外的参数，额外的中间件参数将在<code>$next</code>参数之后传递给中间件</p></blockquote><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=o>&lt;?</span><span class=nx>php</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>namespace</span> <span class=nx>App\Http\Middleware</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>use</span> <span class=nx>Closure</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>use</span> <span class=nx>Illuminate\Http\Request</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>use</span> <span class=nx>Symfony\Component\HttpFoundation\Response</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>EnsureTokenIsValid</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=sd>/**
</span></span></span><span class=line><span class=cl><span class=sd>     * Handle an incoming request.
</span></span></span><span class=line><span class=cl><span class=sd>     *
</span></span></span><span class=line><span class=cl><span class=sd>     * @param \Closure(\Illuminate\Http\Request): (\Symfony\Component\HttpFoundation\Response) $next
</span></span></span><span class=line><span class=cl><span class=sd>     */</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=nf>handle</span><span class=p>(</span><span class=nx>Request</span> <span class=nv>$request</span><span class=p>,</span> <span class=nx>Closure</span> <span class=nv>$next</span><span class=p>,</span> <span class=nx>string</span> <span class=nv>$role</span><span class=p>)</span><span class=o>:</span> <span class=nx>Response</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nv>$request</span><span class=o>-&gt;</span><span class=na>user</span><span class=p>()</span><span class=o>-&gt;</span><span class=na>hasRole</span><span class=p>(</span><span class=nv>$role</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=c1>// 重定向...
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nv>$next</span><span class=p>(</span><span class=nv>$request</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><blockquote><p>在定义路由时，可以指定中间件参数，方法是使用<code>:</code>分割中间件名称和参数。多个参数应以逗号分隔</p></blockquote><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=nx>Route</span><span class=o>::</span><span class=na>put</span><span class=p>(</span><span class=s1>&#39;/post/{id}&#39;</span><span class=p>,</span> <span class=k>function</span> <span class=p>(</span><span class=nx>string</span> <span class=nv>$id</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>})</span><span class=o>-&gt;</span><span class=na>middleware</span><span class=p>(</span><span class=s1>&#39;role:editor&#39;</span><span class=p>);</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=可终止的中间件>可终止的中间件</h3><blockquote><p>部分情况下，在将HTTP响应发送到浏览器之后，中间件可能需要做一些工作。</p><p>如果在中间件上定义了一个<code>terminate</code>方法，并且web服务器使用<code>FastCGI</code>，则在将响应发送到浏览器后会自动调用<code>terminate</code>方法</p></blockquote><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=o>&lt;?</span><span class=nx>php</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>namespace</span> <span class=nx>App\Http\Middleware</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>use</span> <span class=nx>Closure</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>use</span> <span class=nx>Illuminate\Http\Request</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>use</span> <span class=nx>Symfony\Component\HttpFoundation\Response</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>TerminatingMiddleware</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=sd>/**
</span></span></span><span class=line><span class=cl><span class=sd>     * Handle an incoming request.
</span></span></span><span class=line><span class=cl><span class=sd>     *
</span></span></span><span class=line><span class=cl><span class=sd>     * @param \Closure(\Illuminate\Http\Request): (\Symfony\Component\HttpFoundation\Response) $next
</span></span></span><span class=line><span class=cl><span class=sd>     */</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=nf>handle</span><span class=p>(</span><span class=nx>Request</span> <span class=nv>$request</span><span class=p>,</span> <span class=nx>Closure</span> <span class=nv>$next</span><span class=p>)</span><span class=o>:</span> <span class=nx>Response</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nv>$next</span><span class=p>(</span><span class=nv>$request</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=sd>/**
</span></span></span><span class=line><span class=cl><span class=sd>     * 在响应发送到浏览器后处理任务
</span></span></span><span class=line><span class=cl><span class=sd>     *
</span></span></span><span class=line><span class=cl><span class=sd>     * @param Request $request
</span></span></span><span class=line><span class=cl><span class=sd>     * @param Response $response
</span></span></span><span class=line><span class=cl><span class=sd>     * @return void
</span></span></span><span class=line><span class=cl><span class=sd>     */</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=nf>terminate</span><span class=p>(</span><span class=nx>Request</span> <span class=nv>$request</span><span class=p>,</span> <span class=nx>Response</span> <span class=nv>$response</span><span class=p>)</span><span class=o>:</span> <span class=nx>void</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>//...
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><blockquote><p><code>terminate</code>方法应该同时接收请求和响应。一旦定义了一个可终止的中间件，应该将它添加到<code>app/Http/Kernel.php</code>文件中的路由或全局中间件列表中。</p></blockquote><blockquote><p>当在中间件上调用<code>terminate</code>方法时，Laravel会从服务器容器解析一个新的中间件实例。如果想在调用<code>handle</code>和<code>terminate</code>方法时使用相同的中间件实例，可以使用容器的<code>singleton</code>方法向容器注册中间件。通常应该在项目的<code>AppServiceProvider</code>的<code>register</code>方法中完成</p></blockquote><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=o>&lt;?</span><span class=nx>php</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>namespace</span> <span class=nx>App\Providers</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>use</span> <span class=nx>App\Http\Middleware\TerminatingMiddleware</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>use</span> <span class=nx>Illuminate\Support\ServiceProvider</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>AppServiceProvider</span> <span class=k>extends</span> <span class=nx>ServiceProvider</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=sd>/**
</span></span></span><span class=line><span class=cl><span class=sd>     * Register any application services.
</span></span></span><span class=line><span class=cl><span class=sd>     */</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=nf>register</span><span class=p>()</span><span class=o>:</span> <span class=nx>void</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>//
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>app</span><span class=o>-&gt;</span><span class=na>singleton</span><span class=p>(</span><span class=nx>TerminatingMiddleware</span><span class=o>::</span><span class=na>class</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=o>...</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h1 id=控制器-1>控制器</h1><p>控制器可以将相关的请求处理逻辑分组到一个类中。</p><p>例如：一个<code>UserController</code>类可能会处理所有与用户相关的传入请求，包括显示、创建、更新和删除用户。默认情况下，控制器存储在<code>app/Http/Controller</code>目录中。</p><h2 id=编写控制器>编写控制器</h2><h3 id=基本控制器>基本控制器</h3><blockquote><p>可以使用<code>make:controller</code>Artisan命令快速生成新控制器</p></blockquote><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>php artisan make:controller UserController
</span></span></code></pre></td></tr></table></div></div><blockquote><p>默认情况下生成在<code>app/Http/Controller</code>目录中，可以通过指定路径子目录<code>Api/UserController</code>进行生成，这样生成后的目录在<code>app/Http/Controller/Api</code>目录下</p></blockquote><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>php artisan make:controller Api/UserController
</span></span></code></pre></td></tr></table></div></div><p><strong>示例</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=o>&lt;?</span><span class=nx>php</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>namespace</span> <span class=nx>App\Http\Controllers\Api</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>use</span> <span class=nx>App\Http\Controllers\Controller</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>use</span> <span class=nx>Illuminate\Http\Request</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>UserController</span> <span class=k>extends</span> <span class=nx>Controller</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=nf>show</span><span class=p>(</span><span class=nx>string</span> <span class=nv>$id</span><span class=p>)</span><span class=o>:</span> <span class=nx>string</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=s1>&#39;User&#39;</span> <span class=o>.</span> <span class=nv>$id</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>定义到控制器方法的路由：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=k>use</span> <span class=nx>App\Http\Controllers\Api\UserController</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>Route</span><span class=o>::</span><span class=na>get</span><span class=p>(</span><span class=s1>&#39;/user/{id}&#39;</span><span class=p>,</span> <span class=p>[</span><span class=nx>UserController</span><span class=o>::</span><span class=na>class</span><span class=p>,</span> <span class=s1>&#39;show&#39;</span><span class=p>]);</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=单动作控制器>单动作控制器</h3><p>如果控制器动作特别复杂，可能会发现将整个控制器专用于该单个动作很方便。为此，可以在控制器中定义一个<code>__invoke</code>方法。</p><blockquote><p>可以使用<code>make:controller</code>Artisan命令的<code>--invokable</code>选项生成可调用控制器</p></blockquote><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=nx>php</span> <span class=nx>artisan</span> <span class=nx>make</span><span class=o>:</span><span class=nx>controller</span> <span class=nx>ProvisionServer</span> <span class=o>--</span><span class=nx>invokable</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>生成的控制器：</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=o>&lt;?</span><span class=nx>php</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>namespace</span> <span class=nx>App\Http\Controllers\Api</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>use</span> <span class=nx>App\Http\Controllers\Controller</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>use</span> <span class=nx>Illuminate\Http\Request</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>ProvisionServer</span> <span class=k>extends</span> <span class=nx>Controller</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=sd>/**
</span></span></span><span class=line><span class=cl><span class=sd>     * Handle the incoming request.
</span></span></span><span class=line><span class=cl><span class=sd>     */</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=fm>__invoke</span><span class=p>(</span><span class=nx>Request</span> <span class=nv>$request</span><span class=p>)</span><span class=o>:</span> <span class=k>array</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>//
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=k>return</span> <span class=nv>$request</span><span class=o>-&gt;</span><span class=na>all</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>为单动作控制器注册路由时，不需要指定控制器方法。可以简单地将控制器的名称传递给路由器：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=k>use</span> <span class=nx>App\Http\Controllers\Api\ProvisionServer</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>Route</span><span class=o>::</span><span class=na>get</span><span class=p>(</span><span class=s1>&#39;/server&#39;</span><span class=p>,</span> <span class=nx>ProvisionServer</span><span class=o>::</span><span class=na>class</span><span class=p>);</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=控制器中间件>控制器中间件</h2><p>中间件可以在路由文件中分配给控制器的路由：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=nx>Route</span><span class=o>::</span><span class=na>get</span><span class=p>(</span><span class=s1>&#39;/user/{id}&#39;</span><span class=p>,</span> <span class=p>[</span><span class=nx>UserController</span><span class=o>::</span><span class=na>class</span><span class=p>,</span> <span class=s1>&#39;show&#39;</span><span class=p>])</span><span class=o>-&gt;</span><span class=na>middleware</span><span class=p>(</span><span class=s1>&#39;auth&#39;</span><span class=p>);</span>
</span></span></code></pre></td></tr></table></div></div><p>也可以在控制器的构造函数中指定中间件。使用控制器构造函数中的<code>middleware</code>方法将中间件分配给控制器的操作：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=o>&lt;?</span><span class=nx>php</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>namespace</span> <span class=nx>App\Http\Controllers\Api</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>use</span> <span class=nx>App\Http\Controllers\Controller</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>use</span> <span class=nx>Closure</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>use</span> <span class=nx>Illuminate\Http\Request</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>UserController</span> <span class=k>extends</span> <span class=nx>Controller</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=fm>__construct</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>middleware</span><span class=p>(</span><span class=s1>&#39;auth&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>middleware</span><span class=p>(</span><span class=s1>&#39;log&#39;</span><span class=p>)</span><span class=o>-&gt;</span><span class=na>only</span><span class=p>(</span><span class=s1>&#39;index&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>middleware</span><span class=p>(</span><span class=s1>&#39;subscribed&#39;</span><span class=p>)</span><span class=o>-&gt;</span><span class=na>except</span><span class=p>(</span><span class=s1>&#39;store&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1>// 控制器还允许使用闭包注册中间件
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>middleware</span><span class=p>(</span><span class=k>function</span> <span class=p>(</span><span class=nx>Request</span> <span class=nv>$request</span><span class=p>,</span> <span class=nx>Closure</span> <span class=nv>$next</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=nv>$next</span><span class=p>(</span><span class=nv>$request</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>});</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=nf>show</span><span class=p>(</span><span class=nx>string</span> <span class=nv>$id</span><span class=p>)</span><span class=o>:</span> <span class=nx>string</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=s1>&#39;User&#39;</span> <span class=o>.</span> <span class=nv>$id</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=资源控制器>资源控制器</h2><p>如果将应用程序中的每个Eloquent模型都是为资源，那么通常对应用程序中的每个资源都执行相同的操作。</p><p>Laravel的资源路由通过单行代码即可将典型的增删改查(CURD)路由分配给控制器。首相，使用Artisan命令<code>make:controller</code>的<code>--resource</code>选项来快速创建一个控制器</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=o>&lt;?</span><span class=nx>php</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>namespace</span> <span class=nx>App\Http\Controllers\Api</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>use</span> <span class=nx>App\Http\Controllers\Controller</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>use</span> <span class=nx>Illuminate\Http\Request</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>PhotoController</span> <span class=k>extends</span> <span class=nx>Controller</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=sd>/**
</span></span></span><span class=line><span class=cl><span class=sd>     * Display a listing of the resource.
</span></span></span><span class=line><span class=cl><span class=sd>     */</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=nf>index</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>//
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=sd>/**
</span></span></span><span class=line><span class=cl><span class=sd>     * Show the form for creating a new resource.
</span></span></span><span class=line><span class=cl><span class=sd>     */</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=nf>create</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>//
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=sd>/**
</span></span></span><span class=line><span class=cl><span class=sd>     * Store a newly created resource in storage.
</span></span></span><span class=line><span class=cl><span class=sd>     */</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=nf>store</span><span class=p>(</span><span class=nx>Request</span> <span class=nv>$request</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>//
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=sd>/**
</span></span></span><span class=line><span class=cl><span class=sd>     * Display the specified resource.
</span></span></span><span class=line><span class=cl><span class=sd>     */</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=nf>show</span><span class=p>(</span><span class=nx>string</span> <span class=nv>$id</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>//
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=sd>/**
</span></span></span><span class=line><span class=cl><span class=sd>     * Show the form for editing the specified resource.
</span></span></span><span class=line><span class=cl><span class=sd>     */</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=nf>edit</span><span class=p>(</span><span class=nx>string</span> <span class=nv>$id</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>//
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=sd>/**
</span></span></span><span class=line><span class=cl><span class=sd>     * Update the specified resource in storage.
</span></span></span><span class=line><span class=cl><span class=sd>     */</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=nf>update</span><span class=p>(</span><span class=nx>Request</span> <span class=nv>$request</span><span class=p>,</span> <span class=nx>string</span> <span class=nv>$id</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>//
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=sd>/**
</span></span></span><span class=line><span class=cl><span class=sd>     * Remove the specified resource from storage.
</span></span></span><span class=line><span class=cl><span class=sd>     */</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=nf>destroy</span><span class=p>(</span><span class=nx>string</span> <span class=nv>$id</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>//
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>给控制器注册一个资源路由：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=k>use</span> <span class=nx>App\Http\Controllers\Api\PhotoController</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>Route</span><span class=o>::</span><span class=na>resource</span><span class=p>(</span><span class=s1>&#39;photos&#39;</span><span class=p>,</span> <span class=nx>PhotoController</span><span class=o>::</span><span class=na>class</span><span class=p>);</span>
</span></span></code></pre></td></tr></table></div></div><p>这个单一的路由声明创建了多个路由来处理资源上的各种行为，可以通过<code>php artisan route:list</code>来快速了解：</p><p><img class=lazyload src=/svg/loading.min.svg data-src=https://raw.githubusercontent.com/XD825/picgo/main/img/202305112219104.png data-srcset="https://raw.githubusercontent.com/XD825/picgo/main/img/202305112219104.png, https://raw.githubusercontent.com/XD825/picgo/main/img/202305112219104.png 1.5x, https://raw.githubusercontent.com/XD825/picgo/main/img/202305112219104.png 2x" data-sizes=auto alt=https://raw.githubusercontent.com/XD825/picgo/main/img/202305112219104.png title=image-20230511221846162></p><h3 id=自定义缺失模型行为>自定义缺失模型行为</h3><p>通常如果未找到隐式绑定的资源模型，则会生成状态码为404的HTTP响应。但是可以通过在定义资源路由时调用<code>missing</code>的方法来自定义该行为。<code>missing</code>方法接受一个闭包，如果对任何资源的路由都找不到隐式绑定模型，则将调用该闭包：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=nx>Route</span><span class=o>::</span><span class=na>resource</span><span class=p>(</span><span class=s1>&#39;photos&#39;</span><span class=p>,</span> <span class=nx>PhotoController</span><span class=o>::</span><span class=na>class</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=o>-&gt;</span><span class=na>missing</span><span class=p>(</span><span class=k>function</span> <span class=p>(</span><span class=nx>Request</span> <span class=nv>$request</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nx>Redirect</span><span class=o>::</span><span class=na>route</span><span class=p>(</span><span class=s1>&#39;photos.index&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>});</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=软删除模型>软删除模型</h3><p>通常情况下，隐式模型绑定将不会检索已经进行了软删除的模型，并且会返回一个404HTTP响应。但是，可以在定义资源路由时调用<code>withTrashed</code>方法来告诉框架允许软删除的模型：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=k>use</span> <span class=nx>App\Http\Controllers\Api\PhotoController</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>Route</span><span class=o>::</span><span class=na>resource</span><span class=p>(</span><span class=s1>&#39;photos&#39;</span><span class=p>,</span> <span class=nx>PhotoController</span><span class=o>::</span><span class=na>class</span><span class=p>)</span><span class=o>-&gt;</span><span class=na>withTrashed</span><span class=p>();</span>
</span></span></code></pre></td></tr></table></div></div><p>当不传递参数调用<code>withTrashed</code>时，将在<code>show</code>、<code>edit</code> 和 <code>update</code>资源路由中允许软删除的模型。可以通过一个数组指定这些路由的子集传递给<code>withTrashed</code>方法：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=nx>Route</span><span class=o>::</span><span class=na>resource</span><span class=p>(</span><span class=s1>&#39;photos&#39;</span><span class=p>,</span> <span class=nx>PhotoController</span><span class=o>::</span><span class=na>class</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=o>-&gt;</span><span class=na>withTrashed</span><span class=p>([</span><span class=s1>&#39;show&#39;</span><span class=p>]);</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=指定资源模型>指定资源模型</h3><p>如果使用了路由模型的绑定并且想在资源控制器的方法中使用类型提示，可以在生成控制器的时候使用<code>--model</code>选项：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>php artisan make:controller Api/PhotoController --model<span class=o>=</span>Photo --resource
</span></span></code></pre></td></tr></table></div></div><h3 id=生成表单请求>生成表单请求</h3><p>可以在生成资源控制器时提供<code>--requests</code>选项来让Artisan位控制器的storage和update方法生成表单请求类：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>php artisan make:controller Api/PhotoController --model<span class=o>=</span>Photo --resource --requests
</span></span></code></pre></td></tr></table></div></div><h3 id=部分资源路由>部分资源路由</h3><p>当声明资源路由时，可以指定控制器处理的部分行为，而不是所有默认的行为：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=k>use</span> <span class=nx>App\Http\Controllers\Api\PhotoController</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>Route</span><span class=o>::</span><span class=na>resource</span><span class=p>(</span><span class=s1>&#39;photos&#39;</span><span class=p>,</span> <span class=nx>PhotoController</span><span class=o>::</span><span class=na>class</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=o>-&gt;</span><span class=na>only</span><span class=p>([</span><span class=s1>&#39;index&#39;</span><span class=p>,</span> <span class=s1>&#39;show&#39;</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>Route</span><span class=o>::</span><span class=na>resource</span><span class=p>(</span><span class=s1>&#39;photos&#39;</span><span class=p>,</span> <span class=nx>PhotoController</span><span class=o>::</span><span class=na>class</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=o>-&gt;</span><span class=na>except</span><span class=p>([</span><span class=s1>&#39;create&#39;</span><span class=p>,</span> <span class=s1>&#39;store&#39;</span><span class=p>,</span> <span class=s1>&#39;update&#39;</span><span class=p>,</span> <span class=s1>&#39;destroy&#39;</span><span class=p>]);</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=api资源路由>API资源路由</h3><p>当声明用于API的资源路由时，通常需要排除显示HTML模板的路由，例如<code>create</code>和<code>edit</code>。为了方便，可以使用<code>apiResource</code>方法来排除这两个路由：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=k>use</span> <span class=nx>App\Http\Controllers\Api\PhotoController</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>Route</span><span class=o>::</span><span class=na>apiResource</span><span class=p>(</span><span class=s1>&#39;photos&#39;</span><span class=p>,</span> <span class=nx>PhotoController</span><span class=o>::</span><span class=na>class</span><span class=p>);</span>
</span></span></code></pre></td></tr></table></div></div><p><img class=lazyload src=/svg/loading.min.svg data-src=https://raw.githubusercontent.com/XD825/picgo/main/img/202305122246719.png data-srcset="https://raw.githubusercontent.com/XD825/picgo/main/img/202305122246719.png, https://raw.githubusercontent.com/XD825/picgo/main/img/202305122246719.png 1.5x, https://raw.githubusercontent.com/XD825/picgo/main/img/202305122246719.png 2x" data-sizes=auto alt=https://raw.githubusercontent.com/XD825/picgo/main/img/202305122246719.png title=image-20230512224640495></p><p>也可以传递一个数组给<code>apiResources</code>方法来同时注册多个API资源控制器：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=nx>Route</span><span class=o>::</span><span class=na>apiResources</span><span class=p>([</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;photos&#39;</span> <span class=o>=&gt;</span> <span class=nx>PhotoController</span><span class=o>::</span><span class=na>class</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;posts&#39;</span> <span class=o>=&gt;</span> <span class=nx>PostController</span><span class=o>::</span><span class=na>class</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=p>]);</span>
</span></span></code></pre></td></tr></table></div></div><p>要快速生成API资源控制器，可以执行<code>make:controller</code>命令时使用<code>--api</code>参数：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>php artisan make:controller PhotoController --api
</span></span></code></pre></td></tr></table></div></div><h3 id=嵌套资源>嵌套资源</h3><p>有时可能需要定义一个嵌套的资源型路由。例如，一个<code>photo</code>资源可能被添加了多个<code>comments</code>。那么可以在路由中使用<code>.</code>符号来声明资源型控制器：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=k>use</span> <span class=nx>App\Http\Controllers\Api\PhotoController</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>Route</span><span class=o>::</span><span class=na>resource</span><span class=p>(</span><span class=s1>&#39;photos.comments&#39;</span><span class=p>,</span> <span class=nx>PhotoController</span><span class=o>::</span><span class=na>class</span><span class=p>);</span>
</span></span></code></pre></td></tr></table></div></div><p><img class=lazyload src=/svg/loading.min.svg data-src=https://raw.githubusercontent.com/XD825/picgo/main/img/202305122304740.png data-srcset="https://raw.githubusercontent.com/XD825/picgo/main/img/202305122304740.png, https://raw.githubusercontent.com/XD825/picgo/main/img/202305122304740.png 1.5x, https://raw.githubusercontent.com/XD825/picgo/main/img/202305122304740.png 2x" data-sizes=auto alt=https://raw.githubusercontent.com/XD825/picgo/main/img/202305122304740.png title=image-20230512230451616></p><h3 id=浅层嵌套>浅层嵌套</h3><p>通常，并不是在所有情况下都需要子啊URI中同时拥有父ID和子ID，因为子ID已经是唯一的标识符。当使用唯一标识符（如自动递增的主键）来表示URI中的模式时，可以选择使用「浅嵌套」的方式定义路由：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=k>use</span> <span class=nx>App\Http\Controllers\Api\PhotoController</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>Route</span><span class=o>::</span><span class=na>resource</span><span class=p>(</span><span class=s1>&#39;photos.comments&#39;</span><span class=p>,</span> <span class=nx>PhotoController</span><span class=o>::</span><span class=na>class</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=o>-&gt;</span><span class=na>shallow</span><span class=p>();</span>
</span></span></code></pre></td></tr></table></div></div><p><img class=lazyload src=/svg/loading.min.svg data-src=https://raw.githubusercontent.com/XD825/picgo/main/img/202305122310007.png data-srcset="https://raw.githubusercontent.com/XD825/picgo/main/img/202305122310007.png, https://raw.githubusercontent.com/XD825/picgo/main/img/202305122310007.png 1.5x, https://raw.githubusercontent.com/XD825/picgo/main/img/202305122310007.png 2x" data-sizes=auto alt=https://raw.githubusercontent.com/XD825/picgo/main/img/202305122310007.png title=image-20230512231000873></p><h3 id=命名资源路由>命名资源路由</h3><p>默认情况下，所有的资源控制器行为都有一个路由名称，可以传入<code>names</code>数组来覆盖这些名称：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=k>use</span> <span class=nx>App\Http\Controllers\Api\PhotoController</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>Route</span><span class=o>::</span><span class=na>resource</span><span class=p>(</span><span class=s1>&#39;photos.comments&#39;</span><span class=p>,</span> <span class=nx>PhotoController</span><span class=o>::</span><span class=na>class</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=o>-&gt;</span><span class=na>names</span><span class=p>([</span><span class=s1>&#39;create&#39;</span> <span class=o>=&gt;</span> <span class=s1>&#39;photos.build&#39;</span><span class=p>]);</span>
</span></span></code></pre></td></tr></table></div></div><p><img class=lazyload src=/svg/loading.min.svg data-src=https://raw.githubusercontent.com/XD825/picgo/main/img/202305122312922.png data-srcset="https://raw.githubusercontent.com/XD825/picgo/main/img/202305122312922.png, https://raw.githubusercontent.com/XD825/picgo/main/img/202305122312922.png 1.5x, https://raw.githubusercontent.com/XD825/picgo/main/img/202305122312922.png 2x" data-sizes=auto alt=https://raw.githubusercontent.com/XD825/picgo/main/img/202305122312922.png title=image-20230512231227788></p><h3 id=命名资源路由参数>命名资源路由参数</h3><p>默认情况下，<code>Route::resource</code>会根据资源名称的单数形式创建资源路由的路由参数。可以使用<code>parameters</code>方法来轻松地覆盖资源路由名称。传入<code>parameters</code>方法应该是自愿名称和参数名称的关联数组：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=k>use</span> <span class=nx>App\Http\Controllers\Api\PhotoController</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>Route</span><span class=o>::</span><span class=na>resource</span><span class=p>(</span><span class=s1>&#39;photos&#39;</span><span class=p>,</span> <span class=nx>PhotoController</span><span class=o>::</span><span class=na>class</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=o>-&gt;</span><span class=na>parameters</span><span class=p>([</span><span class=s1>&#39;photos&#39;</span> <span class=o>=&gt;</span> <span class=s1>&#39;photo_id&#39;</span><span class=p>]);</span>
</span></span></code></pre></td></tr></table></div></div><p><img class=lazyload src=/svg/loading.min.svg data-src=https://raw.githubusercontent.com/XD825/picgo/main/img/202305122317219.png data-srcset="https://raw.githubusercontent.com/XD825/picgo/main/img/202305122317219.png, https://raw.githubusercontent.com/XD825/picgo/main/img/202305122317219.png 1.5x, https://raw.githubusercontent.com/XD825/picgo/main/img/202305122317219.png 2x" data-sizes=auto alt=https://raw.githubusercontent.com/XD825/picgo/main/img/202305122317219.png title=image-20230512231742069></p><h3 id=限定范围的资源路由>限定范围的资源路由</h3><p>Laravel的作用域隐式模型绑定功能可以自动确定嵌套绑定的范围，以便确认已解析的子模型属于父模型。通过在定义嵌套资源时使用<code>scoped</code>方法，可以启用自动范围界定，并指示Laravel应该通过以下方式来检索子资源的哪个字段：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=k>use</span> <span class=nx>App\Http\Controllers\Api\PhotoController</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>Route</span><span class=o>::</span><span class=na>resource</span><span class=p>(</span><span class=s1>&#39;photos.comments&#39;</span><span class=p>,</span> <span class=nx>PhotoController</span><span class=o>::</span><span class=na>class</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=o>-&gt;</span><span class=na>scoped</span><span class=p>([</span><span class=s1>&#39;comment&#39;</span> <span class=o>=&gt;</span> <span class=s1>&#39;slug&#39;</span><span class=p>]);</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=本地化资源uris>本地化资源URIs</h3><p>默认情况下，<code>Route::resource</code>将会用英文动词创建资源URIs。如果需要自定义<code>create</code>和<code>edit</code>行为的动词，可以在<code>App\Providers\RouteServiceProvider</code> 的 <code>boot</code> 方法中使用 <code>Route::resourceVerbs</code> 方法实现：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=k>public</span> <span class=k>function</span> <span class=nf>boot</span><span class=p>()</span><span class=o>:</span> <span class=nx>void</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=o>...</span>
</span></span><span class=line><span class=cl>    <span class=nx>Route</span><span class=o>::</span><span class=na>resourceVerbs</span><span class=p>([</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;create&#39;</span> <span class=o>=&gt;</span> <span class=s1>&#39;crear&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;edit&#39;</span> <span class=o>=&gt;</span> <span class=s1>&#39;editar&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>]);</span>
</span></span><span class=line><span class=cl>    <span class=o>...</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p><img class=lazyload src=/svg/loading.min.svg data-src=https://raw.githubusercontent.com/XD825/picgo/main/img/202305122327997.png data-srcset="https://raw.githubusercontent.com/XD825/picgo/main/img/202305122327997.png, https://raw.githubusercontent.com/XD825/picgo/main/img/202305122327997.png 1.5x, https://raw.githubusercontent.com/XD825/picgo/main/img/202305122327997.png 2x" data-sizes=auto alt=https://raw.githubusercontent.com/XD825/picgo/main/img/202305122327997.png title=image-20230512232706843></p><h3 id=补充资源控制器>补充资源控制器</h3><p>如果需要向资源控制器添加超出默认资源路由集的其他路由，则应在调用<code>Route::resource</code>方法之前定义这些路由；否则，由<code>resource</code>方法定义的路由可能会无意中优先于补充路由：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=k>use</span> <span class=nx>App\Http\Controllers\Api\PhotoController</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>Route</span><span class=o>::</span><span class=na>get</span><span class=p>(</span><span class=s1>&#39;/photos/popular&#39;</span><span class=p>,</span> <span class=p>[</span><span class=nx>PhotoController</span><span class=o>::</span><span class=na>class</span><span class=p>,</span> <span class=s1>&#39;popular&#39;</span><span class=p>]);</span>
</span></span></code></pre></td></tr></table></div></div><p><img class=lazyload src=/svg/loading.min.svg data-src=https://raw.githubusercontent.com/XD825/picgo/main/img/202305122333947.png data-srcset="https://raw.githubusercontent.com/XD825/picgo/main/img/202305122333947.png, https://raw.githubusercontent.com/XD825/picgo/main/img/202305122333947.png 1.5x, https://raw.githubusercontent.com/XD825/picgo/main/img/202305122333947.png 2x" data-sizes=auto alt=https://raw.githubusercontent.com/XD825/picgo/main/img/202305122333947.png title=image-20230512233352814></p><h3 id=单例资源控制器>单例资源控制器</h3><p>有时候，应用中的资源可能只有一个实例，这种情况下，可以注册成单例（signleton）资源控制器：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=k>use</span> <span class=nx>App\Http\Controllers\Api\PhotoController</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>Route</span><span class=o>::</span><span class=na>singleton</span><span class=p>(</span><span class=s1>&#39;photos&#39;</span><span class=p>,</span> <span class=nx>PhotoController</span><span class=o>::</span><span class=na>class</span><span class=p>);</span>
</span></span></code></pre></td></tr></table></div></div><p>单例资源中<code>create</code>路由没有被注册；并且注册的路由不接受路由参数，因为该资源中只有一个实例存在：</p><p><img class=lazyload src=/svg/loading.min.svg data-src=https://raw.githubusercontent.com/XD825/picgo/main/img/202305122336448.png data-srcset="https://raw.githubusercontent.com/XD825/picgo/main/img/202305122336448.png, https://raw.githubusercontent.com/XD825/picgo/main/img/202305122336448.png 1.5x, https://raw.githubusercontent.com/XD825/picgo/main/img/202305122336448.png 2x" data-sizes=auto alt=https://raw.githubusercontent.com/XD825/picgo/main/img/202305122336448.png title=image-20230512233615314></p><p>单例资源也可以在标准资源内嵌套使用：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=nx>Route</span><span class=o>::</span><span class=na>singleton</span><span class=p>(</span><span class=s1>&#39;photos.comments&#39;</span><span class=p>,</span> <span class=nx>PhotoController</span><span class=o>::</span><span class=na>class</span><span class=p>);</span>
</span></span></code></pre></td></tr></table></div></div><p>上例中，<code>photo</code>资源将接收所有的标准资源路由；不过<code>comments</code>资源将会是个单例资源，它的路由如下所示：</p><p><img class=lazyload src=/svg/loading.min.svg data-src=https://raw.githubusercontent.com/XD825/picgo/main/img/202305130007650.png data-srcset="https://raw.githubusercontent.com/XD825/picgo/main/img/202305130007650.png, https://raw.githubusercontent.com/XD825/picgo/main/img/202305130007650.png 1.5x, https://raw.githubusercontent.com/XD825/picgo/main/img/202305130007650.png 2x" data-sizes=auto alt=https://raw.githubusercontent.com/XD825/picgo/main/img/202305130007650.png title=image-20230513000746483></p><h4 id=creatable单例资源>Creatable单例资源</h4><p>有时，可能需要为单例资源定义<code>create</code>和<code>storage</code>路由。要实现这一功能，可以在注册单例资源路由时，调用<code>creatable</code>方法：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=nx>Route</span><span class=o>::</span><span class=na>singleton</span><span class=p>(</span><span class=s1>&#39;photos.comments&#39;</span><span class=p>,</span> <span class=nx>PhotoController</span><span class=o>::</span><span class=na>class</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=o>-&gt;</span><span class=na>creatable</span><span class=p>();</span>
</span></span></code></pre></td></tr></table></div></div><p><img class=lazyload src=/svg/loading.min.svg data-src=https://raw.githubusercontent.com/XD825/picgo/main/img/202305130010713.png data-srcset="https://raw.githubusercontent.com/XD825/picgo/main/img/202305130010713.png, https://raw.githubusercontent.com/XD825/picgo/main/img/202305130010713.png 1.5x, https://raw.githubusercontent.com/XD825/picgo/main/img/202305130010713.png 2x" data-sizes=auto alt=https://raw.githubusercontent.com/XD825/picgo/main/img/202305130010713.png title=image-20230513001057564></p><p>如果希望Laravel为单个资源注册<code>DETELE</code>路由，但不注册创建或存储路由，则可以使用<code>destroyable</code>方法：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=nx>Route</span><span class=o>::</span><span class=na>singleton</span><span class=p>(</span><span class=s1>&#39;photos.comments&#39;</span><span class=p>,</span> <span class=nx>PhotoController</span><span class=o>::</span><span class=na>class</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=o>-&gt;</span><span class=na>destroyable</span><span class=p>();</span>
</span></span></code></pre></td></tr></table></div></div><p><img class=lazyload src=/svg/loading.min.svg data-src=https://raw.githubusercontent.com/XD825/picgo/main/img/202305130012543.png data-srcset="https://raw.githubusercontent.com/XD825/picgo/main/img/202305130012543.png, https://raw.githubusercontent.com/XD825/picgo/main/img/202305130012543.png 1.5x, https://raw.githubusercontent.com/XD825/picgo/main/img/202305130012543.png 2x" data-sizes=auto alt=https://raw.githubusercontent.com/XD825/picgo/main/img/202305130012543.png title=image-20230513001241365></p><h4 id=api单例资源>API单例资源</h4><p><code>apiSingleton</code>方法可用于注册将通过API操作的单例资源，从而不需要<code>create</code>和<code>edit</code>路由：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=nx>Route</span><span class=o>::</span><span class=na>apiSingleton</span><span class=p>(</span><span class=s1>&#39;photos&#39;</span><span class=p>,</span> <span class=nx>PhotoController</span><span class=o>::</span><span class=na>class</span><span class=p>);</span>
</span></span></code></pre></td></tr></table></div></div><p><img class=lazyload src=/svg/loading.min.svg data-src=https://raw.githubusercontent.com/XD825/picgo/main/img/202305130016298.png data-srcset="https://raw.githubusercontent.com/XD825/picgo/main/img/202305130016298.png, https://raw.githubusercontent.com/XD825/picgo/main/img/202305130016298.png 1.5x, https://raw.githubusercontent.com/XD825/picgo/main/img/202305130016298.png 2x" data-sizes=auto alt=https://raw.githubusercontent.com/XD825/picgo/main/img/202305130016298.png title=image-20230513001628209></p><p>API单例资源也可以时<code>creatable</code>，它将注册<code>store</code>和<code>destroy</code>资源路由：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=nx>Route</span><span class=o>::</span><span class=na>apiSingleton</span><span class=p>(</span><span class=s1>&#39;photos&#39;</span><span class=p>,</span> <span class=nx>PhotoController</span><span class=o>::</span><span class=na>class</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=o>-&gt;</span><span class=na>creatable</span><span class=p>();</span>
</span></span></code></pre></td></tr></table></div></div><p><img class=lazyload src=/svg/loading.min.svg data-src=https://raw.githubusercontent.com/XD825/picgo/main/img/202305130018473.png data-srcset="https://raw.githubusercontent.com/XD825/picgo/main/img/202305130018473.png, https://raw.githubusercontent.com/XD825/picgo/main/img/202305130018473.png 1.5x, https://raw.githubusercontent.com/XD825/picgo/main/img/202305130018473.png 2x" data-sizes=auto alt=https://raw.githubusercontent.com/XD825/picgo/main/img/202305130018473.png title=image-20230513001837389></p><h2 id=依赖注入和控制器>依赖注入和控制器</h2><h3 id=构造函数注入>构造函数注入</h3><p>Laravel服务容器用于解析所有Laravel控制器。因此，可以在其构造函数中对控制器可能需要的任何依赖项进行类型提示。声明的依赖项将自动解析并注入到控制器实例中：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=o>&lt;?</span><span class=nx>php</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>namespace</span> <span class=nx>App\Http\Controllers</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>use</span> <span class=nx>App\Repositories\UserRepository</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>UserController</span> <span class=k>extends</span> <span class=nx>Controller</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=sd>/**
</span></span></span><span class=line><span class=cl><span class=sd>     * 创建新控制器实例。
</span></span></span><span class=line><span class=cl><span class=sd>     */</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=fm>__construct</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=k>protected</span> <span class=nx>UserRepository</span> <span class=nv>$users</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=方法注入>方法注入</h3><p>方法注入的一个常见用例时将<code>Illuminate\Http\Request</code>实例注入到控制器方法中：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=o>&lt;?</span><span class=nx>php</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>namespace</span> <span class=nx>App\Http\Controllers\Api</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>use</span> <span class=nx>App\Http\Controllers\Controller</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>use</span> <span class=nx>Illuminate\Http\Request</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>UserController</span> <span class=k>extends</span> <span class=nx>Controller</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=fm>__construct</span><span class=p>(</span><span class=nx>Request</span> <span class=nv>$request</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nv>$name</span> <span class=o>=</span> <span class=nv>$request</span><span class=o>-&gt;</span><span class=na>name</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nx>redirect</span><span class=p>(</span><span class=s1>&#39;/users&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>如果控制器方法也需要路由参数，那就在其他依赖项之后列出路由参数即可：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=k>use</span> <span class=nx>App\Http\Controllers\UserController</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>Route</span><span class=o>::</span><span class=na>put</span><span class=p>(</span><span class=s1>&#39;/user/{id}&#39;</span><span class=p>,</span> <span class=p>[</span><span class=nx>UserController</span><span class=o>::</span><span class=na>class</span><span class=p>,</span> <span class=s1>&#39;update&#39;</span><span class=p>]);</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=o>&lt;?</span><span class=nx>php</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>namespace</span> <span class=nx>App\Http\Controllers</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>use</span> <span class=nx>Illuminate\Http\RedirectResponse</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>use</span> <span class=nx>Illuminate\Http\Request</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>UserController</span> <span class=k>extends</span> <span class=nx>Controller</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=sd>/**
</span></span></span><span class=line><span class=cl><span class=sd>     * 更新给定用户。
</span></span></span><span class=line><span class=cl><span class=sd>     */</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=nf>update</span><span class=p>(</span><span class=nx>Request</span> <span class=nv>$request</span><span class=p>,</span> <span class=nx>string</span> <span class=nv>$id</span><span class=p>)</span><span class=o>:</span> <span class=nx>RedirectResponse</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// 更新用户。。。
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nx>redirect</span><span class=p>(</span><span class=s1>&#39;/users&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h1 id=http请求>HTTP请求</h1><p>Laravel的<code>Illuminate\Http\Request</code>类提供了一种面向对象的方式来与当前由应用程序处理的HTTP请求进行交互，并检索提交请求的输入内容、Cookie和文件。</p><h2 id=与请求交互>与请求交互</h2><h3 id=访问请求>访问请求</h3><p>要通过依赖注入获取当前的HTTP请求实例，应该在路由闭包或控制器方法中导入<code>Illuminate\Http\Request</code>类。传入的请求实例将由Laravel服务容器自动注入：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=o>&lt;?</span><span class=nx>php</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>namespace</span> <span class=nx>App\Http\Controllers\Api</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>use</span> <span class=nx>App\Http\Controllers\Controller</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>use</span> <span class=nx>Illuminate\Http\Request</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>UserController</span> <span class=k>extends</span> <span class=nx>Controller</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=fm>__construct</span><span class=p>(</span><span class=nx>Request</span> <span class=nv>$request</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nv>$name</span> <span class=o>=</span> <span class=nv>$request</span><span class=o>-&gt;</span><span class=na>name</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nx>redirect</span><span class=p>(</span><span class=s1>&#39;/users&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=nf>show</span><span class=p>(</span><span class=nx>string</span> <span class=nv>$id</span><span class=p>)</span><span class=o>:</span> <span class=nx>string</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=s1>&#39;User&#39;</span> <span class=o>.</span> <span class=nv>$id</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=请求路径主机和方法>请求路径、主机和方法</h3><p><code>Illuminate\Http\Request</code>实例提供各种方法来检查传入的HTTP请求，并扩展了<code>Symfony\Component\HttpFoundation\Request</code>类。</p><h4 id=获取请求路径>获取请求路径</h4><p><code>path</code>方法返回请求的路径信息。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=c1>// 访问：http://127.0.0.1:8000/api/user/1
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nv>$uri</span> <span class=o>=</span> <span class=nv>$request</span><span class=o>-&gt;</span><span class=na>path</span><span class=p>();</span> <span class=c1>// api/user/1
</span></span></span></code></pre></td></tr></table></div></div><h4 id=检查请求路径路由信息>检查请求路径/路由信息</h4><p><code>is</code>方法允许验证传入请求路径是否与给定的模式匹配。当使用此方法时，可以使用<code>*</code>字符作为通配符：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=k>if</span> <span class=p>(</span><span class=nv>$request</span><span class=o>-&gt;</span><span class=na>is</span><span class=p>(</span><span class=s1>&#39;admin/*&#39;</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>使用<code>routeIs</code>方法，可以确定传入的请求是否与命名路由匹配：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=k>if</span> <span class=p>(</span><span class=nv>$request</span><span class=o>-&gt;</span><span class=na>routeIs</span><span class=p>(</span><span class=s1>&#39;admin.*&#39;</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=获取请求url>获取请求URL</h4><p>要获取传入请求的完整URL，可以使用<code>url</code>或<code>fullUrl</code>方法。</p><p><code>url</code>方法将返回不带查询字符串的URL，而<code>fullUrl</code>方法将包括查询字符串：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=c1>// 访问：http://127.0.0.1:8000/api/user/1?type=2
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=nv>$url</span> <span class=o>=</span> <span class=nv>$request</span><span class=o>-&gt;</span><span class=na>url</span><span class=p>();</span> <span class=c1>// http://127.0.0.1:8000/api/user/1
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=nv>$urlWithQueryString</span> <span class=o>=</span> <span class=nv>$request</span><span class=o>-&gt;</span><span class=na>fullUrl</span><span class=p>();</span> <span class=c1>// http://127.0.0.1:8000/api/user/1?type=2
</span></span></span></code></pre></td></tr></table></div></div><p>如果想将查询字符串数据附加到当前URL，请调用<code>fullUrlWithQuery</code>方法。此方法将给定的查询字符串变量数组与当前查询字符串合并：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=nv>$request</span><span class=o>-&gt;</span><span class=na>fullUrlWithQuery</span><span class=p>([</span><span class=s1>&#39;phone&#39;</span> <span class=o>=&gt;</span> <span class=s1>&#39;11111&#39;</span><span class=p>]);</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=获取请求host>获取请求Host</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=nx>Route</span><span class=o>::</span><span class=na>get</span><span class=p>(</span><span class=s1>&#39;/getHost&#39;</span><span class=p>,</span> <span class=k>function</span> <span class=p>(</span><span class=nx>Request</span> <span class=nv>$request</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nv>$host</span> <span class=o>=</span> <span class=nv>$request</span><span class=o>-&gt;</span><span class=na>host</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=nv>$httpHost</span> <span class=o>=</span> <span class=nv>$request</span><span class=o>-&gt;</span><span class=na>httpHost</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=nv>$schemeAndHttpHost</span> <span class=o>=</span> <span class=nv>$request</span><span class=o>-&gt;</span><span class=na>schemeAndHttpHost</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>[</span><span class=s1>&#39;host&#39;</span> <span class=o>=&gt;</span> <span class=nv>$host</span><span class=p>,</span> <span class=s1>&#39;httpHost&#39;</span> <span class=o>=&gt;</span> <span class=nv>$httpHost</span><span class=p>,</span> <span class=s1>&#39;schemeAndHttpHost&#39;</span> <span class=o>=&gt;</span> <span class=nv>$schemeAndHttpHost</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// {
</span></span></span><span class=line><span class=cl><span class=c1>// &#34;host&#34;: &#34;127.0.0.1&#34;,
</span></span></span><span class=line><span class=cl><span class=c1>// &#34;httpHost&#34;: &#34;127.0.0.1:8000&#34;,
</span></span></span><span class=line><span class=cl><span class=c1>// &#34;schemeAndHttpHost&#34;: &#34;http://127.0.0.1:8000&#34;
</span></span></span><span class=line><span class=cl><span class=c1>// }
</span></span></span></code></pre></td></tr></table></div></div><h4 id=获取请求方法>获取请求方法</h4><p><code>method</code>方法将返回请求的HTTP动词，可以使用<code>isMethod</code>方法来验证HTTP动词是否与给定的字符串匹配：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=nv>$method</span> <span class=o>=</span> <span class=nv>$request</span><span class=o>-&gt;</span><span class=na>method</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=p>(</span><span class=nv>$request</span><span class=o>-&gt;</span><span class=na>isMethod</span><span class=p>(</span><span class=s1>&#39;post&#39;</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=请求头>请求头</h3><p>使用<code>header</code>方法从<code>Illuminate\Http\Request</code>实例中检索请求标头。如果请求中没有标头，则返回<code>null</code>。<code>header</code>方法接受两个可选参数，如果该标头在请求中不存在，则返回第二个参数：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=nv>$header</span> <span class=o>=</span> <span class=nv>$request</span><span class=o>-&gt;</span><span class=na>header</span><span class=p>(</span><span class=s1>&#39;X-Header-Name&#39;</span><span class=p>);</span> <span class=c1>// null
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=nv>$header</span> <span class=o>=</span> <span class=nv>$request</span><span class=o>-&gt;</span><span class=na>header</span><span class=p>(</span><span class=s1>&#39;X-Header-Name&#39;</span><span class=p>,</span> <span class=s1>&#39;default&#39;</span><span class=p>);</span> <span class=c1>// default
</span></span></span></code></pre></td></tr></table></div></div><p><code>hasHeader</code>方法可用于确定请求是否包含给定的标头：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=k>if</span> <span class=p>(</span><span class=nv>$request</span><span class=o>-&gt;</span><span class=na>hasHeader</span><span class=p>(</span><span class=s1>&#39;X-Header-Name&#39;</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p><code>bearerToken</code>方法可用于从<code>Authorization</code>标头检索授权标记。如果不存在此类标头，将返回一个空字符串：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=nv>$bearerToken</span> <span class=o>=</span> <span class=nv>$request</span><span class=o>-&gt;</span><span class=na>bearerToken</span><span class=p>();</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=请求ip地址>请求IP地址</h3><p><code>ip</code>方法可用于检索应用程序发出请求的客户端的IP地址：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=nv>$ip</span> <span class=o>=</span> <span class=nv>$request</span><span class=o>-&gt;</span><span class=na>ip</span><span class=p>();</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=内容协商>内容协商</h3><p>Laravel提供了几种方法，通过<code>Accept</code>标头检查传入请求的请求内容类型。首先，<code>getAcceptableContentTypes</code>方法将返回包含请求接受的所有内容类型的数组：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=nv>$acceptableContentTypes</span> <span class=o>=</span> <span class=nv>$request</span><span class=o>-&gt;</span><span class=na>getAcceptableContentTypes</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>//    [
</span></span></span><span class=line><span class=cl><span class=c1>//        &#34;text/html&#34;,
</span></span></span><span class=line><span class=cl><span class=c1>//        &#34;application/xhtml+xml&#34;,
</span></span></span><span class=line><span class=cl><span class=c1>//        &#34;image/avif&#34;,
</span></span></span><span class=line><span class=cl><span class=c1>//        &#34;image/webp&#34;,
</span></span></span><span class=line><span class=cl><span class=c1>//        &#34;image/apng&#34;,
</span></span></span><span class=line><span class=cl><span class=c1>//        &#34;application/xml&#34;,
</span></span></span><span class=line><span class=cl><span class=c1>//        &#34;*/*&#34;,
</span></span></span><span class=line><span class=cl><span class=c1>//        &#34;application/signed-exchange&#34;
</span></span></span><span class=line><span class=cl><span class=c1>//    ]
</span></span></span></code></pre></td></tr></table></div></div><p><code>accepts</code>方法接收一个内容类型数组，并在请求接受任何内容类型时返回<code>true</code>。否则将返回<code>false</code>：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=k>if</span> <span class=p>(</span><span class=nv>$request</span><span class=o>-&gt;</span><span class=na>accepts</span><span class=p>([</span><span class=s1>&#39;text/html&#39;</span><span class=p>,</span> <span class=s1>&#39;application/json&#39;</span><span class=p>]))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p><code>prefers</code>方法确定给定内容类型数组中的哪种内容类型由请求最具优势。如果请求未接受任何提供的内容类型，则返回<code>null</code>：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=nv>$prefers</span> <span class=o>=</span> <span class=nv>$request</span><span class=o>-&gt;</span><span class=na>prefers</span><span class=p>([</span><span class=s1>&#39;text/html&#39;</span><span class=p>,</span> <span class=s1>&#39;application/json&#39;</span><span class=p>]);</span> <span class=c1>// text/html
</span></span></span></code></pre></td></tr></table></div></div><p>由于许多应用程序仅提供HTML或JSON，因此可以使用<code>expectsJson</code>方法快速确定传入请求是否期望获得JSON响应：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=k>if</span> <span class=p>(</span><span class=nv>$request</span><span class=o>-&gt;</span><span class=na>expectsJson</span><span class=p>()){</span>
</span></span><span class=line><span class=cl>    <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=psr-7请求>PSR-7请求</h3><h2 id=输入>输入</h2><h3 id=检索输入>检索输入</h3><h4 id=检索所有输入数据>检索所有输入数据</h4><p>使用<code>all</code>方法将所有传入请求的输入数据作为<code>array</code>检索。无论传入请求是否来自于HTML表单或XHR请求：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=nv>$all</span> <span class=o>=</span> <span class=nv>$request</span><span class=o>-&gt;</span><span class=na>all</span><span class=p>();</span>
</span></span></code></pre></td></tr></table></div></div><p>使用<code>collect</code>方法，可以将所有传入请求的输入数据作为集合检索：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=nv>$collection</span> <span class=o>=</span> <span class=nv>$request</span><span class=o>-&gt;</span><span class=na>collect</span><span class=p>();</span>
</span></span></code></pre></td></tr></table></div></div><p><code>collect</code>方法还允许将传入请求的子集作为集合检索：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=nv>$request</span><span class=o>-&gt;</span><span class=na>collect</span><span class=p>(</span><span class=s1>&#39;users&#39;</span><span class=p>)</span><span class=o>-&gt;</span><span class=na>each</span><span class=p>(</span><span class=k>function</span> <span class=p>(</span><span class=nx>string</span> <span class=nv>$user</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>});</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=检索输入值>检索输入值</h4><p><code>input</code>方法可用于检索用户输入：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=nv>$name</span> <span class=o>=</span> <span class=nv>$request</span><span class=o>-&gt;</span><span class=na>input</span><span class=p>(</span><span class=s1>&#39;name&#39;</span><span class=p>);</span>
</span></span></code></pre></td></tr></table></div></div><p>可以将默认值作为第二个参数传递给<code>input</code>方法。如果请求中不存在所请求的输入值，则返回此值：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=nv>$name</span> <span class=o>=</span> <span class=nv>$request</span><span class=o>-&gt;</span><span class=na>input</span><span class=p>(</span><span class=s1>&#39;name&#39;</span><span class=p>,</span> <span class=s1>&#39;desire&#39;</span><span class=p>);</span>
</span></span></code></pre></td></tr></table></div></div><p>处理包含数组输入的表单时，使用<code>.</code>符号访问数组：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=nv>$name</span> <span class=o>=</span> <span class=nv>$request</span><span class=o>-&gt;</span><span class=na>input</span><span class=p>(</span><span class=s1>&#39;products.0.name&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nv>$names</span> <span class=o>=</span> <span class=nv>$request</span><span class=o>-&gt;</span><span class=na>input</span><span class=p>(</span><span class=s1>&#39;products.*.name&#39;</span><span class=p>);</span>
</span></span></code></pre></td></tr></table></div></div><p>如果不带任何参数的<code>input</code>方法，以将所有输入值作为关联数组检索出来：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=nv>$input</span> <span class=o>=</span> <span class=nv>$request</span><span class=o>-&gt;</span><span class=na>input</span><span class=p>();</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=从查询字符串检索输入>从查询字符串检索输入</h4><p><code>query</code>方法仅从查询字符串检索值</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=nv>$queryName</span> <span class=o>=</span> <span class=nv>$request</span><span class=o>-&gt;</span><span class=na>query</span><span class=p>(</span><span class=s1>&#39;name&#39;</span><span class=p>);</span>
</span></span></code></pre></td></tr></table></div></div><p>如果请求的查询字符串值数据不存在，则将返回此方法的第二个参数：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=nv>$queryName</span> <span class=o>=</span> <span class=nv>$request</span><span class=o>-&gt;</span><span class=na>query</span><span class=p>(</span><span class=s1>&#39;name&#39;</span><span class=p>,</span> <span class=s1>&#39;Desire&#39;</span><span class=p>);</span>
</span></span></code></pre></td></tr></table></div></div><p>如果调用不带任何参数的<code>query</code>方法，以将所有查询字符串值作为关联数组检索出来：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=nv>$query</span> <span class=o>=</span> <span class=nv>$request</span><span class=o>-&gt;</span><span class=na>query</span><span class=p>();</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=检索可字符串化的输入值>检索可字符串化的输入值</h4><p>可以使用<code>string</code>方法将请求的输入数据检索为<code>Illuminate\Http\Request</code>的实例，而不是将其作为基本<code>string</code>检索：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=nv>$stringAble</span> <span class=o>=</span> <span class=nv>$request</span><span class=o>-&gt;</span><span class=na>string</span><span class=p>(</span><span class=s1>&#39;name&#39;</span><span class=p>)</span><span class=o>-&gt;</span><span class=na>trim</span><span class=p>();</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=检索布尔值输入>检索布尔值输入</h4><p>可以使用<code>boolean</code>方法进行布尔值检索。</p><p>对于 1，「1」，true，「true」，「on」和「yes」，返回 <code>true</code>。所有其他值将返回 <code>false</code>：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=nv>$archived</span> <span class=o>=</span> <span class=nv>$request</span><span class=o>-&gt;</span><span class=na>boolean</span><span class=p>(</span><span class=s1>&#39;archived&#39;</span><span class=p>);</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=检索日期输入值>检索日期输入值</h4><p>包含日期/时间的输入值可以使用<code>date</code>方法检索为<code>Carbon</code>实例。如果请求中不包含给定名称的输入值，则返回<code>null</code>：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=nv>$birthday</span> <span class=o>=</span> <span class=nv>$request</span><span class=o>-&gt;</span><span class=na>date</span><span class=p>(</span><span class=s1>&#39;birthday&#39;</span><span class=p>);</span>
</span></span></code></pre></td></tr></table></div></div><p><code>date</code>方法可接受的第二个和第三个参数可用于分别指定日期的格式和时区：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=nv>$elapsed</span> <span class=o>=</span> <span class=nv>$request</span><span class=o>-&gt;</span><span class=na>date</span><span class=p>(</span><span class=s1>&#39;elapsed&#39;</span><span class=p>,</span> <span class=s1>&#39;!H:i&#39;</span><span class=p>,</span> <span class=s1>&#39;Europe/Madrid&#39;</span><span class=p>);</span>
</span></span></code></pre></td></tr></table></div></div><p>如果输入值存在但格式无效，则会抛出一个<code>InvalidArgumentException</code>异常；因此，在调用<code>date</code>方法之前建议对输入进行验证。</p><h4 id=检索枚举输入值>检索枚举输入值</h4><p><code>enum</code>方法接受输入值的名称和枚举类作为其第一个和第二个参数。</p><p>如果请求中不包含给定名称的输入值或枚举没有与输入值匹配的备份值，则返回<code>null</code></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=k>use</span> <span class=nx>App\Enums\Status</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>$status</span> <span class=o>=</span> <span class=nv>$request</span><span class=o>-&gt;</span><span class=na>enum</span><span class=p>(</span><span class=s1>&#39;status&#39;</span><span class=p>,</span> <span class=nx>Status</span><span class=o>::</span><span class=na>class</span><span class=p>);</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=通过动态属性检索输入>通过动态属性检索输入</h4><p>可以使用<code>Illuminate\Http\Request</code>实例上的动态属性访问用户输入：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=nv>$name</span> <span class=o>=</span> <span class=nv>$request</span><span class=o>-&gt;</span><span class=na>name</span><span class=p>;</span>
</span></span></code></pre></td></tr></table></div></div><p>使用动态属性时，Laravel首先会在请求负载中查找参数的值，如果不存在，则会在匹配路由的参数中搜索该字段。</p><h4 id=检索输入数据的一部分>检索输入数据的一部分</h4><p>如果需要检索输入数据的子集，则可以使用<code>only</code>和<code>except</code>方法。这两个方法都接受一个单一的<code>array</code>或动态参数列表：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=nv>$only</span> <span class=o>=</span> <span class=nv>$request</span><span class=o>-&gt;</span><span class=na>only</span><span class=p>([</span><span class=s1>&#39;username&#39;</span><span class=p>,</span> <span class=s1>&#39;password&#39;</span><span class=p>]);</span>
</span></span><span class=line><span class=cl><span class=nv>$only1</span> <span class=o>=</span> <span class=nv>$request</span><span class=o>-&gt;</span><span class=na>only</span><span class=p>(</span><span class=s1>&#39;username&#39;</span><span class=p>,</span> <span class=s1>&#39;password&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nv>$except</span> <span class=o>=</span> <span class=nv>$request</span><span class=o>-&gt;</span><span class=na>except</span><span class=p>([</span><span class=s1>&#39;credit_card&#39;</span><span class=p>]);</span>
</span></span><span class=line><span class=cl><span class=nv>$except1</span> <span class=o>=</span> <span class=nv>$request</span><span class=o>-&gt;</span><span class=na>except</span><span class=p>(</span><span class=s1>&#39;credit_card&#39;</span><span class=p>);</span>
</span></span></code></pre></td></tr></table></div></div><p>注：<code>only</code>方法返回请求的所有键值对；但是，不会返回请求中不存在的键值对。</p><h3 id=判断输入是否存在>判断输入是否存在</h3><p>可以使用<code>has</code>方法来确定请求中是否存在某个值。如果请求中存在该值则返回<code>true</code>：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=k>if</span> <span class=p>(</span><span class=nv>$request</span><span class=o>-&gt;</span><span class=na>has</span><span class=p>(</span><span class=s1>&#39;name&#39;</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>当给定一个数组时，<code>has</code>方法将确定所有指定的值是否都存在：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=k>if</span> <span class=p>(</span><span class=nv>$request</span><span class=o>-&gt;</span><span class=na>has</span><span class=p>([</span><span class=s1>&#39;name&#39;</span><span class=p>,</span> <span class=s1>&#39;email&#39;</span><span class=p>]))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p><code>whenHas</code>方法将在请求中存在一个值时执行给定的闭包：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=nv>$request</span><span class=o>-&gt;</span><span class=na>whenHas</span><span class=p>(</span><span class=s1>&#39;name&#39;</span><span class=p>,</span> <span class=k>function</span> <span class=p>(</span><span class=nx>string</span> <span class=nv>$input</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>});</span>
</span></span></code></pre></td></tr></table></div></div><p>可以通过向<code>whenHas</code>方法传递第二个闭包来执行在请求中没有指定值的情况：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=nv>$request</span><span class=o>-&gt;</span><span class=na>whenHas</span><span class=p>(</span><span class=s1>&#39;name&#39;</span><span class=p>,</span> <span class=k>function</span> <span class=p>(</span><span class=nx>string</span> <span class=nv>$input</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// &#34;name&#34; 值存在...
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>},</span> <span class=k>function</span> <span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// &#34;name&#34; 值不存在...
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>});</span>
</span></span></code></pre></td></tr></table></div></div><p><code>hasAny</code>方法放回<code>true</code>，如果任意指定的值存在，则返回<code>true</code>：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=k>if</span> <span class=p>(</span><span class=nv>$request</span><span class=o>-&gt;</span><span class=na>hasAny</span><span class=p>([</span><span class=s1>&#39;name&#39;</span><span class=p>,</span> <span class=s1>&#39;email&#39;</span><span class=p>]))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>如果想要确定请求中是否存在一个值且不是一个空字符串，则可以使用<code>fulled</code>方法：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=k>if</span> <span class=p>(</span><span class=nv>$request</span><span class=o>-&gt;</span><span class=na>filled</span><span class=p>(</span><span class=s1>&#39;name&#39;</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p><code>whenFilled</code>方法将请求中存在一个值且不是空字符串时执行给定的闭包：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=nv>$request</span><span class=o>-&gt;</span><span class=na>whenFilled</span><span class=p>(</span><span class=s1>&#39;name&#39;</span><span class=p>,</span> <span class=k>function</span> <span class=p>(</span><span class=nx>string</span> <span class=nv>$input</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>});</span>
</span></span></code></pre></td></tr></table></div></div><p>可以通过向<code>whenFilled</code>方法传递第二个闭包来执行在请求中没有指定值的情况：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=nv>$request</span><span class=o>-&gt;</span><span class=na>whenFilled</span><span class=p>(</span><span class=s1>&#39;name&#39;</span><span class=p>,</span> <span class=k>function</span> <span class=p>(</span><span class=nx>string</span> <span class=nv>$input</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// &#34;name&#34; 值已填写...
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>},</span> <span class=k>function</span> <span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// &#34;name&#34; 值未填写...
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>});</span>
</span></span></code></pre></td></tr></table></div></div><p>要确定给定的键是否不存在请求中，可以使用<code>missing</code>和<code>whenMissing</code>方法：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=k>if</span> <span class=p>(</span><span class=nv>$request</span><span class=o>-&gt;</span><span class=na>missing</span><span class=p>(</span><span class=s1>&#39;name&#39;</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>$request</span><span class=o>-&gt;</span><span class=na>whenMissing</span><span class=p>(</span><span class=s1>&#39;name&#39;</span><span class=p>,</span> <span class=k>function</span> <span class=p>(</span><span class=k>array</span> <span class=nv>$input</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// &#34;name&#34; 值缺失...
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>},</span> <span class=k>function</span> <span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// &#34;name&#34; 值存在...
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>});</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=合并其他输入>合并其他输入</h3><p>可以使用<code>merge</code>方法，手动将其他输入合并到请求的向右输入数据中。如果给定的输入键已经存在于请求中，它将被提供给<code>merge</code>方法的数据覆盖：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=nv>$request</span><span class=o>-&gt;</span><span class=na>merge</span><span class=p>([</span><span class=s1>&#39;votes&#39;</span> <span class=o>=&gt;</span> <span class=mi>0</span><span class=p>]);</span>
</span></span></code></pre></td></tr></table></div></div><p>如果请求的输入数据中不存在相应的键，则可以使用<code>mergeIfMissing</code>方法将输入合并到请求中：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=nv>$request</span><span class=o>-&gt;</span><span class=na>mergeIfMissing</span><span class=p>([</span><span class=s1>&#39;votes&#39;</span> <span class=o>=&gt;</span> <span class=mi>0</span><span class=p>]);</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=旧输入>旧输入</h3><p>Laravel允许在两次请求之间保留数据。这个特性在检测到验证错误后重新填充表单时特别有用。但是，如果使用Laravel的包含的表单验证，不需要自己手动调用这些方法，因为Laravel的一些内置验证功能将自动调用它们。</p><h3 id=闪存>闪存</h3><h4 id=闪存输入到session>闪存输入到Session</h4><p>在<code>Illuminate\Http\Request</code>类上的<code>flash</code>方法将当前输入闪存到session，以便在下一次用户请求应用程序时使用：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=nv>$request</span><span class=o>-&gt;</span><span class=na>flash</span><span class=p>();</span>
</span></span></code></pre></td></tr></table></div></div><p>还可以使用<code>flashOnly</code>和<code>flashExcept</code>方法闪存一部分请求数据到Session。这些方法对于将敏感信息（如密码）排除在Session外的情况下非常有用：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=nv>$request</span><span class=o>-&gt;</span><span class=na>flashOnly</span><span class=p>([</span><span class=s1>&#39;username&#39;</span><span class=p>,</span> <span class=s1>&#39;email&#39;</span><span class=p>]);</span>
</span></span><span class=line><span class=cl><span class=nv>$request</span><span class=o>-&gt;</span><span class=na>flashExcept</span><span class=p>(</span><span class=s1>&#39;password&#39;</span><span class=p>);</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=闪存输入后重定向>闪存输入后重定向</h4><p>可以使用<code>withInput</code>方法将输入闪存到重定向中：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=k>return</span> <span class=nx>redirect</span><span class=p>(</span><span class=s1>&#39;form&#39;</span><span class=p>)</span><span class=o>-&gt;</span><span class=na>withInput</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>return</span> <span class=nx>redirect</span><span class=p>()</span><span class=o>-&gt;</span><span class=na>route</span><span class=p>(</span><span class=s1>&#39;user.create&#39;</span><span class=p>)</span><span class=o>-&gt;</span><span class=na>withInput</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>return</span> <span class=nx>redirect</span><span class=p>(</span><span class=s1>&#39;form&#39;</span><span class=p>)</span><span class=o>-&gt;</span><span class=na>withInput</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=nv>$request</span><span class=o>-&gt;</span><span class=na>except</span><span class=p>(</span><span class=s1>&#39;password&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>);</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=检索旧输入值>检索旧输入值</h4><p>若要获取上一次请求所保存的就输入数据，可以在<code>Illuminate\Http\Request</code>的实例上调用<code>old</code>方法，<code>old</code>方法会从session中检索先前闪存的输入数据：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=nv>$username</span> <span class=o>=</span> <span class=nv>$request</span><span class=o>-&gt;</span><span class=na>old</span><span class=p>(</span><span class=s1>&#39;username&#39;</span><span class=p>);</span>
</span></span></code></pre></td></tr></table></div></div><p>此外，Laravel还提供了一个全局辅助函数<code>old</code>。如果在<code>Blade</code>模板中显示旧的输入，则更方便使用<code>old</code>辅助函数重新填充表单。如果给定字段没有就输入，则会返回<code>null</code>：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=o>&lt;</span><span class=nx>input</span> <span class=nx>type</span><span class=o>=</span><span class=s2>&#34;text&#34;</span> <span class=nx>name</span><span class=o>=</span><span class=s2>&#34;username&#34;</span> <span class=nx>value</span><span class=o>=</span><span class=s2>&#34;{{ old(&#39;username&#39;) }}&#34;</span><span class=o>&gt;</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=cookies>Cookies</h3><h4 id=检索请求中的cookies>检索请求中的Cookies</h4><p>Laravel框架创建的所有cookies都经过加密并签名，这意味着如果客户端更改了cookie值，则这些cookie将被视为无效。要从请求中检索cookie值，在<code>Illuminate\Http\Request</code>实例上使用<code>cookie</code>方法：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=nv>$cookie</span> <span class=o>=</span> <span class=nv>$request</span><span class=o>-&gt;</span><span class=na>cookie</span><span class=p>(</span><span class=s1>&#39;name&#39;</span><span class=p>);</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=输入过滤和规范化>输入过滤和规范化</h2><p>默认情况下，Laravel在应用程序的全局中间件中包含<code>App\Http\Middleware\TrimStrings</code>和<code>Illuminate\Foundation\Http\Middleware\ConvertEmptyStringsToNull</code>中间件。这些中间件在<code>App\Http\Kernel</code>类的全局中间件中列出。这些中间件将自动修剪请求中的字符串字段，并将任何空字符串转换为<code>null</code>。</p><h4 id=禁用输入规范化>禁用输入规范化</h4><p>如果要禁用所有请求的该行为，可以从 <code>App\Http\Kernel</code> 类的 <code>$middleware</code> 属性中删除这两个中间件，从而将它们从应用程序的中间件栈中删除。</p><p>如果想要禁用应用程序的一部分请求的字符串修剪和空字符串转换，可以使用中间件提供的 <code>skipWhen</code> 方法。该方法接受一个闭包，该闭包应返回 <code>true</code> 或 <code>false</code>，以指示是否应跳过输入规范化。通常情况下，需要在应用程序的 <code>AppServiceProvider</code> 的 <code>boot</code> 方法中调用 <code>skipWhen</code> 方法。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=k>use</span> <span class=nx>App\Http\Middleware\TrimStrings</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>use</span> <span class=nx>Illuminate\Http\Request</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>use</span> <span class=nx>Illuminate\Foundation\Http\Middleware\ConvertEmptyStringsToNull</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=sd>/**
</span></span></span><span class=line><span class=cl><span class=sd> * Bootstrap any application services.
</span></span></span><span class=line><span class=cl><span class=sd> */</span>
</span></span><span class=line><span class=cl><span class=k>public</span> <span class=k>function</span> <span class=nf>boot</span><span class=p>()</span><span class=o>:</span> <span class=nx>void</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>TrimStrings</span><span class=o>::</span><span class=na>skipWhen</span><span class=p>(</span><span class=k>function</span> <span class=p>(</span><span class=nx>Request</span> <span class=nv>$request</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nv>$request</span><span class=o>-&gt;</span><span class=na>is</span><span class=p>(</span><span class=s1>&#39;admin/*&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nx>ConvertEmptyStringsToNull</span><span class=o>::</span><span class=na>skipWhen</span><span class=p>(</span><span class=k>function</span> <span class=p>(</span><span class=nx>Request</span> <span class=nv>$request</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=p>});</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=文件>文件</h2><h3 id=检索上传的文件>检索上传的文件</h3><p>可以使用<code>file</code>方法或动态属性从<code>Illuminate\Http\Request</code>实例中检索已上传的文件。<code>file</code>方法返回<code>Illuminate\Http\UploadedFile</code>类的实例，该类扩展了PHP的<code>SplFileInfo</code>类，并提供了各种用于与文件交互的方法：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=nv>$file</span> <span class=o>=</span> <span class=nv>$request</span><span class=o>-&gt;</span><span class=na>file</span><span class=p>(</span><span class=s1>&#39;photo&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>$file</span> <span class=o>=</span> <span class=nv>$request</span><span class=o>-&gt;</span><span class=na>photo</span><span class=p>;</span>
</span></span></code></pre></td></tr></table></div></div><p>可以使用<code>hasFile</code>方法检查请求中是否存在文件：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=k>if</span> <span class=p>(</span><span class=nv>$request</span><span class=o>-&gt;</span><span class=na>hasFile</span><span class=p>(</span><span class=s1>&#39;photo&#39;</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=验证成功上传的文件>验证成功上传的文件</h4><p>除了检查文件是否存在之外，还可以通过<code>isValid</code>方法验证上传文件时是否存在问题：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=k>if</span> <span class=p>(</span><span class=nv>$request</span><span class=o>-&gt;</span><span class=na>file</span><span class=p>(</span><span class=s1>&#39;photo&#39;</span><span class=p>)</span><span class=o>-&gt;</span><span class=na>isValid</span><span class=p>())</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=文件路径和扩展名>文件路径和扩展名</h4><p><code>UploadedFile</code> 类还包含访问文件的完全限定路径及其扩展名的方法。<code>extension</code> 方法将尝试基于其内容猜测文件的扩展名。此扩展名可能与客户端提供的扩展名不同：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=nv>$path</span> <span class=o>=</span> <span class=nv>$request</span><span class=o>-&gt;</span><span class=na>photo</span><span class=o>-&gt;</span><span class=na>path</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>$extension</span> <span class=o>=</span> <span class=nv>$request</span><span class=o>-&gt;</span><span class=na>photo</span><span class=o>-&gt;</span><span class=na>extension</span><span class=p>();</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=存储上传的文件>存储上传的文件</h3><p>要存储已上传的文件，通常会使用您配置的一个文件系统 。<code>UploadedFile</code> 类具有一个 <code>store</code> 方法，该方法将上传的文件移动到您的磁盘中的一个位置，该位置可以是本地文件系统上的位置，也可以是像 Amazon S3 这样的云存储位置。</p><p><code>store</code> 方法接受存储文件的路径，该路径相对于文件系统的配置根目录。此路径不应包含文件名，因为将自动生成唯一的 ID 作为文件名。</p><p><code>store</code> 方法还接受一个可选的第二个参数，用于指定应用于存储文件的磁盘的名称。该方法将返回相对于磁盘根目录的文件路径：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=nv>$path</span> <span class=o>=</span> <span class=nv>$request</span><span class=o>-&gt;</span><span class=na>photo</span><span class=o>-&gt;</span><span class=na>store</span><span class=p>(</span><span class=s1>&#39;images&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>$path</span> <span class=o>=</span> <span class=nv>$request</span><span class=o>-&gt;</span><span class=na>photo</span><span class=o>-&gt;</span><span class=na>store</span><span class=p>(</span><span class=s1>&#39;images&#39;</span><span class=p>,</span> <span class=s1>&#39;s3&#39;</span><span class=p>);</span>
</span></span></code></pre></td></tr></table></div></div><p>如果不希望自动生成文件名，则可以使用<code>storeAs</code>方法，该方法接受路径、文件名和磁盘名称作为其参数：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=nv>$path</span> <span class=o>=</span> <span class=nv>$request</span><span class=o>-&gt;</span><span class=na>photo</span><span class=o>-&gt;</span><span class=na>storeAs</span><span class=p>(</span><span class=s1>&#39;images&#39;</span><span class=p>,</span> <span class=s1>&#39;filename.jpg&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>$path</span> <span class=o>=</span> <span class=nv>$request</span><span class=o>-&gt;</span><span class=na>photo</span><span class=o>-&gt;</span><span class=na>storeAs</span><span class=p>(</span><span class=s1>&#39;images&#39;</span><span class=p>,</span> <span class=s1>&#39;filename.jpg&#39;</span><span class=p>,</span> <span class=s1>&#39;s3&#39;</span><span class=p>);</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=配置受信任的代理>配置受信任的代理</h2><p>使用 <code>App\Http\Middleware\TrustProxies</code> 中间件，这个中间件已经包含在 Laravel 应用程序中，它允许快速定制应用程序应信任的负载均衡器或代理。信任的代理应该被列在此中间件的 <code>$proxies</code> 属性上的数组中。除了配置受信任的代理之外，还可以配置应该信任的代理 <code>$headers</code>：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=o>&lt;?</span><span class=nx>php</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>namespace</span> <span class=nx>App\Http\Middleware</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>use</span> <span class=nx>Illuminate\Http\Middleware\TrustProxies</span> <span class=k>as</span> <span class=nx>Middleware</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>use</span> <span class=nx>Illuminate\Http\Request</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>TrustProxies</span> <span class=k>extends</span> <span class=nx>Middleware</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=sd>/**
</span></span></span><span class=line><span class=cl><span class=sd>     * 此应用程序的受信任代理。
</span></span></span><span class=line><span class=cl><span class=sd>     *
</span></span></span><span class=line><span class=cl><span class=sd>     * @var string|array
</span></span></span><span class=line><span class=cl><span class=sd>     */</span>
</span></span><span class=line><span class=cl>    <span class=k>protected</span> <span class=nv>$proxies</span> <span class=o>=</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;192.168.1.1&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;192.168.1.2&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>];</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=sd>/**
</span></span></span><span class=line><span class=cl><span class=sd>     * 应用于检测代理的标头。
</span></span></span><span class=line><span class=cl><span class=sd>     *
</span></span></span><span class=line><span class=cl><span class=sd>     * @var int
</span></span></span><span class=line><span class=cl><span class=sd>     */</span>
</span></span><span class=line><span class=cl>    <span class=k>protected</span> <span class=nv>$headers</span> <span class=o>=</span> <span class=nx>Request</span><span class=o>::</span><span class=na>HEADER_X_FORWARDED_FOR</span> <span class=o>|</span> <span class=nx>Request</span><span class=o>::</span><span class=na>HEADER_X_FORWARDED_HOST</span> <span class=o>|</span> <span class=nx>Request</span><span class=o>::</span><span class=na>HEADER_X_FORWARDED_PORT</span> <span class=o>|</span> <span class=nx>Request</span><span class=o>::</span><span class=na>HEADER_X_FORWARDED_PROTO</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>注意</strong>
如果正在使用 AWS 弹性负载平衡，请将 <code>$headers</code> 值设置为 <code>Request::HEADER_X_FORWARDED_AWS_ELB</code></p><p><strong>信任所有代理</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=sd>/**
</span></span></span><span class=line><span class=cl><span class=sd> * 应用所信任的代理。
</span></span></span><span class=line><span class=cl><span class=sd> *
</span></span></span><span class=line><span class=cl><span class=sd> * @var string|array
</span></span></span><span class=line><span class=cl><span class=sd> */</span>
</span></span><span class=line><span class=cl><span class=k>protected</span> <span class=nv>$proxies</span> <span class=o>=</span> <span class=s1>&#39;*&#39;</span><span class=p>;</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=配置可信任的host>配置可信任的Host</h2><p>默认情况下，Laravel 将响应它接收到的所有请求，而不管 HTTP 请求的 <code>Host</code> 标头的内容是什么。此外，在 web 请求期间生成应用程序的绝对 URL 时，将使用 <code>Host</code> 头的值。</p><p>通常情况下，应该配置 Web 服务器（如 Nginx 或 Apache）仅向匹配给定主机名的应用程序发送请求。然而，如果没有直接自定义 Web 服务器的能力，需要指示 Laravel 仅响应特定主机名的请求，可以为应用程序启用<code> App\Http\Middleware\TrustHosts</code> 中间件。</p><p><code>TrustHosts</code> 中间件已经包含在应用程序的 <code>$middleware</code> 堆栈中；但是，应该将其取消注释以使其生效。在此中间件的 <code>hosts</code> 方法中，可以指定应用程序应该响应的主机名。具有其他 <code>Host</code> 值标头的传入请求将被拒绝：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=sd>/**
</span></span></span><span class=line><span class=cl><span class=sd> * 获取应被信任的主机模式。
</span></span></span><span class=line><span class=cl><span class=sd> *
</span></span></span><span class=line><span class=cl><span class=sd> * @return array&lt;int, string&gt;
</span></span></span><span class=line><span class=cl><span class=sd> */</span>
</span></span><span class=line><span class=cl><span class=k>public</span> <span class=k>function</span> <span class=nf>hosts</span><span class=p>()</span><span class=o>:</span> <span class=k>array</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;laravel.test&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>allSubdomainsOfApplicationUrl</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>    <span class=p>];</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p><code>allSubdomainsOfApplicationUrl</code> 帮助程序方法将返回与应用程序<code>app.url</code>配置值的所有子域相匹配的正则表达式。在构建利用通配符子域的应用程序时，这个帮助程序提供了一种方便的方法来允许所有应用程序的子域。</p><h1 id=响应>响应</h1><h2 id=创建响应>创建响应</h2><h3 id=字符串--数组>字符串 & 数组</h3><p>最基本就是从路由或控制器返回一个简单的字符串，框架会自动将这个字符串转化为一个完整的HTTP响应：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=nx>Route</span><span class=o>::</span><span class=na>get</span><span class=p>(</span><span class=s1>&#39;/&#39;</span><span class=p>,</span> <span class=k>function</span> <span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=s1>&#39;Hello PHP!&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span></code></pre></td></tr></table></div></div><p>也可以返回数组，框架会自动将数组转换为JSON响应：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=nx>Route</span><span class=o>::</span><span class=na>get</span><span class=p>(</span><span class=s1>&#39;/&#39;</span><span class=p>,</span> <span class=k>function</span> <span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>[</span><span class=mi>1</span><span class=p>,</span> <span class=mi>3</span><span class=p>,</span> <span class=mi>4</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=response对象>Response对象</h3><p>返回一个完整的<code>Illuminate\Http\Response</code>实力允许自定义返回的HTTP状态码和返回头信息。<code>Response</code>实例继承自<code>Symfony\Component\HttpFoundation\Response</code>类，此类提供了各种构建HTTP响应的方法：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=nx>Route</span><span class=o>::</span><span class=na>get</span><span class=p>(</span><span class=s1>&#39;/home&#39;</span><span class=p>,</span> <span class=k>function</span> <span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>response</span><span class=p>(</span><span class=s1>&#39;Hello PHP!&#39;</span><span class=p>,</span> <span class=mi>200</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=o>-&gt;</span><span class=na>header</span><span class=p>(</span><span class=s1>&#39;Content-Type&#39;</span><span class=p>,</span> <span class=s1>&#39;text/plain&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=eloquent模型和集合>Eloquent模型和集合</h3><p>可以直接从路由和控制器返回 <a href=https://learnku.com/docs/laravel/10.x/eloquent target=_blank rel="noopener noreffer">Eloquent ORM</a> 模型和集合。这样做时，Laravel 将自动将模型和集合转换为 JSON 响应，同时遵循模型的 <a href=https://learnku.com/docs/laravel/10.x/eloquent-serialization#hiding-attributes-from-json target=_blank rel="noopener noreffer">隐藏属性</a>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=k>use</span> <span class=nx>App\Models\User</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>Route</span><span class=o>::</span><span class=na>get</span><span class=p>(</span><span class=s1>&#39;/user/{user}&#39;</span><span class=p>,</span> <span class=k>function</span> <span class=p>(</span><span class=nx>User</span> <span class=nv>$user</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nv>$user</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=添加响应头>添加响应头</h3><p>可以使用<code>header</code>方法将一系列头添加到响应中：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=k>return</span> <span class=nx>response</span><span class=p>(</span><span class=nv>$content</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=o>-&gt;</span><span class=na>header</span><span class=p>(</span><span class=s1>&#39;Content-Type&#39;</span><span class=p>,</span> <span class=nv>$type</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=o>-&gt;</span><span class=na>header</span><span class=p>(</span><span class=s1>&#39;X-Header-One&#39;</span><span class=p>,</span> <span class=s1>&#39;Header Value&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=o>-&gt;</span><span class=na>header</span><span class=p>(</span><span class=s1>&#39;X-Header-Two&#39;</span><span class=p>,</span> <span class=s1>&#39;Header Value&#39;</span><span class=p>);</span>
</span></span></code></pre></td></tr></table></div></div><p>也可以使用<code>withHeaders</code>方法指定要添加到响应的标头数组：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=k>return</span> <span class=nx>response</span><span class=p>(</span><span class=nv>$content</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=o>-&gt;</span><span class=na>withHeaders</span><span class=p>([</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;Content-Type&#39;</span> <span class=o>=&gt;</span> <span class=nv>$type</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;X-Header-One&#39;</span> <span class=o>=&gt;</span> <span class=s1>&#39;Header Value&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;X-Header-Two&#39;</span> <span class=o>=&gt;</span> <span class=s1>&#39;Header Value&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>]);</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=缓存控制中间件>缓存控制中间件</h3><p>Laravel包含一个<code>cache.headers</code>中间件，可用于快速设置一组路由的<code>CaChe-Control</code>标头。指令应使用相应缓存控制指定的蛇形命名法等效项提供，并应以分号分割。如果在指令列表中指定了<code>etag</code>，则响应内容的MD5哈希将自动设置为<code>ETag</code>标识符：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=nx>Route</span><span class=o>::</span><span class=na>middleware</span><span class=p>(</span><span class=s1>&#39;cache.headers:public;max_age=2628000;etag&#39;</span><span class=p>)</span><span class=o>-&gt;</span><span class=na>group</span><span class=p>(</span><span class=k>function</span> <span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>Route</span><span class=o>::</span><span class=na>get</span><span class=p>(</span><span class=s1>&#39;/privacy&#39;</span><span class=p>,</span> <span class=k>function</span> <span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nx>Route</span><span class=o>::</span><span class=na>get</span><span class=p>(</span><span class=s1>&#39;/terms&#39;</span><span class=p>,</span> <span class=k>function</span> <span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=p>});</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=添加响应cookies>添加响应Cookies</h3><p>可以使用<code>cookie</code>方法将cookie附加到传出的<code>Illumize\Http\Response</code>实例，应将cookie的名称、值和有效分钟数传递给此方法：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=k>return</span> <span class=nx>response</span><span class=p>(</span><span class=s1>&#39;Hello World&#39;</span><span class=p>)</span><span class=o>-&gt;</span><span class=na>cookie</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;name&#39;</span><span class=p>,</span> <span class=s1>&#39;value&#39;</span><span class=p>,</span> <span class=nv>$minutes</span>
</span></span><span class=line><span class=cl><span class=p>);</span>
</span></span></code></pre></td></tr></table></div></div><p><code>cookie</code>方法还接受一些使用频率较低的参数。通常，这些参数的目的和意义与PHP原生setcookie的参数相同</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=k>return</span> <span class=nx>response</span><span class=p>(</span><span class=s1>&#39;Hello World&#39;</span><span class=p>)</span><span class=o>-&gt;</span><span class=na>cookie</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;name&#39;</span><span class=p>,</span> <span class=s1>&#39;value&#39;</span><span class=p>,</span> <span class=nv>$minutes</span><span class=p>,</span> <span class=nv>$path</span><span class=p>,</span> <span class=nv>$domain</span><span class=p>,</span> <span class=nv>$secure</span><span class=p>,</span> <span class=nv>$httpOnly</span>
</span></span><span class=line><span class=cl><span class=p>);</span>
</span></span></code></pre></td></tr></table></div></div><p>如果希望确保cookie与传出响应一起发送，但还没有该响应的实例，则可以使用<code>Cookie</code>facade将cookie加入队列，以便在发送响应时附加到响应中。<code>queue</code>方法接受创建cookie实例所需的参数。在发送到浏览器之前，这些cookies将附加到传出的响应中：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=k>use</span> <span class=nx>Illuminate\Support\Facades\Cookie</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>Cookie</span><span class=o>::</span><span class=na>queue</span><span class=p>(</span><span class=s1>&#39;name&#39;</span><span class=p>,</span> <span class=s1>&#39;value&#39;</span><span class=p>,</span> <span class=nv>$minutes</span><span class=p>);</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=生成cookie实例>生成Cookie实例</h4><p>如果要生成一个<code>Symfony\Component\HttpFoundation\Cookie</code>实例，打算稍后附加到响应实例中。可以使用全局<code>cookie</code>助手函数。此cookie将不会发送回客户端，除非它被附加到响应实例中：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=nv>$cookie</span> <span class=o>=</span> <span class=nx>cookie</span><span class=p>(</span><span class=s1>&#39;name&#39;</span><span class=p>,</span> <span class=s1>&#39;value&#39;</span><span class=p>,</span> <span class=nv>$minutes</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>return</span> <span class=nx>response</span><span class=p>(</span><span class=s1>&#39;Hello PHP&#39;</span><span class=p>)</span><span class=o>-&gt;</span><span class=na>cookie</span><span class=p>(</span><span class=nv>$cookie</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=提前过期cookies>提前过期Cookies</h4><p>可以通过响应中的<code>withoutCookie</code>方法使Cookie过期，用于删除Cookie：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=k>return</span> <span class=nx>response</span><span class=p>(</span><span class=s1>&#39;Hello PHP&#39;</span><span class=p>)</span><span class=o>-&gt;</span><span class=na>withoutCookie</span><span class=p>(</span><span class=s1>&#39;name&#39;</span><span class=p>);</span>
</span></span></code></pre></td></tr></table></div></div><p>如果尚未有创建响应的实例，则可以使用<code>Cookie</code>facade中的<code>expire</code>方法使Cookie过期：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=nx>Cookie</span><span class=o>::</span><span class=na>expire</span><span class=p>(</span><span class=s1>&#39;name&#39;</span><span class=p>);</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=cookies--加密>Cookies & 加密</h3><p>默认情况下，由 Laravel 生成的所有 cookie 都经过了加密和签名，因此客户端无法篡改或读取它们。如果要对应用程序生成的部分 cookie 禁用加密，可以使用 <code>App\Http\Middleware\EncryptCookies</code> 中间件的 <code>$except</code> 属性，该属性位于 <code>App/Http/Middleware</code> 目录中：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=o>&lt;?</span><span class=nx>php</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>namespace</span> <span class=nx>App\Http\Middleware</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>use</span> <span class=nx>Illuminate\Cookie\Middleware\EncryptCookies</span> <span class=k>as</span> <span class=nx>Middleware</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>EncryptCookies</span> <span class=k>extends</span> <span class=nx>Middleware</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=sd>/**
</span></span></span><span class=line><span class=cl><span class=sd>     * The names of the cookies that should not be encrypted.
</span></span></span><span class=line><span class=cl><span class=sd>     *
</span></span></span><span class=line><span class=cl><span class=sd>     * @var array&lt;int, string&gt;
</span></span></span><span class=line><span class=cl><span class=sd>     */</span>
</span></span><span class=line><span class=cl>    <span class=k>protected</span> <span class=nv>$except</span> <span class=o>=</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>        <span class=c1>//
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=s1>&#39;cookie_name&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>];</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=重定向>重定向</h2><p>重定向响应是 <code>Illuminate\Http\RedirectResponse</code> 类的实例，包含将用户重定向到另一个 URL 所需的适当 HTTP 头。Laravel 有几种方法可以生成 <code>RedirectResponse</code> 实例。最简单的方法是使用全局 <code>redirect</code> 助手函数：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=nx>Route</span><span class=o>::</span><span class=na>get</span><span class=p>(</span><span class=s1>&#39;/dashboard&#39;</span><span class=p>,</span> <span class=k>function</span> <span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>redirect</span><span class=p>(</span><span class=s1>&#39;home/dashboard&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span></code></pre></td></tr></table></div></div><p>有时可能希望将用户重定向到以前的位置，例如当提交的表单无效时，可以使用全局<code>back</code>助手函数来执行操作。由于此功能使用session，请确保调用<code>back</code>函数的路由使用的是<code>web</code>中间件组：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=nx>Route</span><span class=o>::</span><span class=na>post</span><span class=p>(</span><span class=s1>&#39;/user/profile&#39;</span><span class=p>,</span> <span class=k>function</span> <span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 验证请求参数
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>back</span><span class=p>()</span><span class=o>-&gt;</span><span class=na>withInput</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=重定向到指定名称的路由>重定向到指定名称的路由</h3><p>当在没有传递参数的情况下调用<code>redirect</code>助手函数时，将返回<code>Illuminate\Routing\Redirector</code>的实例，允许调用<code>Redirector</code>实例上的任何方法。例如，要对命名路由生成<code>RedirectResponse</code>，可以使用<code>route</code>方法：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=k>return</span> <span class=nx>redirect</span><span class=p>()</span><span class=o>-&gt;</span><span class=na>route</span><span class=p>(</span><span class=s1>&#39;login&#39;</span><span class=p>);</span>
</span></span></code></pre></td></tr></table></div></div><p>如果路由中有参数，可以将其作为第二个参数传递给<code>route</code>方法：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=c1>// 对于具有以下URI的路由: /profile/{id}
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=k>return</span> <span class=nx>redirect</span><span class=p>()</span><span class=o>-&gt;</span><span class=na>route</span><span class=p>(</span><span class=s1>&#39;profile&#39;</span><span class=p>,</span> <span class=p>[</span><span class=s1>&#39;id&#39;</span> <span class=o>=&gt;</span> <span class=mi>1</span><span class=p>]);</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=通过eloquent模型填充参数>通过Eloquent模型填充参数</h4><p>如果要重定向到使用从Eloquent模型田中ID参数的路由，可以直接传递模型本身。ID将会被自动提取：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=c1>// 对于具有以下URI的路由: /profile/{id}
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=k>return</span> <span class=nx>redirect</span><span class=p>()</span><span class=o>-&gt;</span><span class=na>route</span><span class=p>(</span><span class=s1>&#39;profile&#39;</span><span class=p>,</span> <span class=p>[</span><span class=nv>$user</span><span class=p>]);</span>
</span></span></code></pre></td></tr></table></div></div><p>如果想要自定义路由参数，可以指定路由参数(<code>/profile/{id:slug}</code>)或者重写Eloquent模型上<code>getRouteKey</code>方法：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=sd>/**
</span></span></span><span class=line><span class=cl><span class=sd> * 获取模型的路由键值。
</span></span></span><span class=line><span class=cl><span class=sd> */</span>
</span></span><span class=line><span class=cl><span class=k>public</span> <span class=k>function</span> <span class=nf>getRouteKey</span><span class=p>()</span><span class=o>:</span> <span class=nx>mixed</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>slug</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=重定向到控制器方法>重定向到控制器方法</h3><p>也可以生成重定向到<code>controller actions</code>。只要把控制器和<code>action</code>的名称传递给<code>action</code>方法：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=k>use</span> <span class=nx>App\Http\Controllers\UserController</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>return</span> <span class=nx>redirect</span><span class=p>()</span><span class=o>-&gt;</span><span class=na>action</span><span class=p>([</span><span class=nx>UserController</span><span class=o>::</span><span class=na>class</span><span class=p>,</span> <span class=s1>&#39;index&#39;</span><span class=p>]);</span>
</span></span></code></pre></td></tr></table></div></div><p>如果控制器路由有参数，可以将其作为第二个参数传递给<code>action</code>方法：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=k>return</span> <span class=nx>redirect</span><span class=p>()</span><span class=o>-&gt;</span><span class=na>action</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=p>[</span><span class=nx>UserController</span><span class=o>::</span><span class=na>class</span><span class=p>,</span> <span class=s1>&#39;profile&#39;</span><span class=p>],</span> <span class=p>[</span><span class=s1>&#39;id&#39;</span> <span class=o>=&gt;</span> <span class=mi>1</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>);</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=重定向到外部域名>重定向到外部域名</h3><p>有时候需要重定向到应用外的域名。可以通过调用<code>away</code>方法，它会创建一个不带有任何额外的URL编码、有效性校验和检查<code>RedirectResponse</code>实例：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=k>return</span> <span class=nx>redirect</span><span class=p>()</span><span class=o>-&gt;</span><span class=na>away</span><span class=p>(</span><span class=s1>&#39;https://www.google.com&#39;</span><span class=p>);</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=重定向并使用闪存的session数据>重定向并使用闪存的Session数据</h3><p>重定向到新的URL的同时传递数据给session是很常见的。通常在将消息发送给session后成功执行操作后完成的。为了方便，可以创建一个<code>RedirectResponse</code>实例并在链式方法调用中将数据传递给session：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=nx>Route</span><span class=o>::</span><span class=na>post</span><span class=p>(</span><span class=s1>&#39;/user/profile&#39;</span><span class=p>,</span> <span class=k>function</span> <span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>redirect</span><span class=p>(</span><span class=s1>&#39;dashboard&#39;</span><span class=p>)</span><span class=o>-&gt;</span><span class=na>with</span><span class=p>(</span><span class=s1>&#39;status&#39;</span><span class=p>,</span> <span class=s1>&#39;Profile updated!&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=其他响应类型>其他响应类型</h2><p><code>response</code>助手可以用于生成其他类型的响应实例。当不带参数调用<code>response</code>助手时，会返回<code>Illuminate\Contracts\Routing\ResponseFactory</code>contract的实现。该契约提供了几种有用的方法来生成响应。</p><h3 id=视图响应>视图响应</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=k>return</span> <span class=nx>response</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            <span class=o>-&gt;</span><span class=na>view</span><span class=p>(</span><span class=s1>&#39;hello&#39;</span><span class=p>,</span> <span class=nv>$data</span><span class=p>,</span> <span class=mi>200</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=o>-&gt;</span><span class=na>header</span><span class=p>(</span><span class=s1>&#39;Content-Type&#39;</span><span class=p>,</span> <span class=nv>$type</span><span class=p>);</span>
</span></span></code></pre></td></tr></table></div></div><p>如果不需要传递自定义HTTP状态代码或自定义标头，则可以使用全局<code>view</code>辅助函数。</p><h3 id=json响应>JSON响应</h3><p><code>json</code>方法会自动将<code>Content-Type</code>表头设置为<code>application/json</code>，并使用<code>json_encode</code>PHP函数将给定的数组转换为JSON：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=k>return</span> <span class=nx>response</span><span class=p>()</span><span class=o>-&gt;</span><span class=na>json</span><span class=p>([</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;name&#39;</span> <span class=o>=&gt;</span> <span class=s1>&#39;Abigail&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;state&#39;</span> <span class=o>=&gt;</span> <span class=s1>&#39;CA&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=p>]);</span>
</span></span></code></pre></td></tr></table></div></div><p>如果想创建一个JSONP响应，可以结合使用<code>json</code>方法和<code>withCallback</code>方法：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=k>return</span> <span class=nx>response</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            <span class=o>-&gt;</span><span class=na>json</span><span class=p>([</span><span class=s1>&#39;name&#39;</span> <span class=o>=&gt;</span> <span class=s1>&#39;Abigail&#39;</span><span class=p>,</span> <span class=s1>&#39;state&#39;</span> <span class=o>=&gt;</span> <span class=s1>&#39;CA&#39;</span><span class=p>])</span>
</span></span><span class=line><span class=cl>            <span class=o>-&gt;</span><span class=na>withCallback</span><span class=p>(</span><span class=nv>$request</span><span class=o>-&gt;</span><span class=na>input</span><span class=p>(</span><span class=s1>&#39;callback&#39;</span><span class=p>));</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=文件下载>文件下载</h3><p><code>download</code>方法可用于生成强制用户浏览器在给定路径下载文件的响应。<code>download</code>方法接受文件名作为该方法的第二个参数，这将确定下载文件的用户看到的文件名。最后，可以将一组HTTP标头作为该方法的第三个参数传递：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=k>return</span> <span class=nx>response</span><span class=p>()</span><span class=o>-&gt;</span><span class=na>download</span><span class=p>(</span><span class=nv>$pathToFile</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>return</span> <span class=nx>response</span><span class=p>()</span><span class=o>-&gt;</span><span class=na>download</span><span class=p>(</span><span class=nv>$pathToFile</span><span class=p>,</span> <span class=nv>$name</span><span class=p>,</span> <span class=nv>$headers</span><span class=p>);</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=流式下载>流式下载</h4><p>有时候可能希望将给定操作的字符串响应转换为可下载的响应，而不必将操作的内容写入磁盘。在这种情况下，可以使用<code>streamDownload</code>方法。此方法接受回调、文件名和可选的标头数组作为其参数：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=k>use</span> <span class=nx>App\Services\GitHub</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>return</span> <span class=nx>response</span><span class=p>()</span><span class=o>-&gt;</span><span class=na>streamDownload</span><span class=p>(</span><span class=k>function</span> <span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>echo</span> <span class=nx>GitHub</span><span class=o>::</span><span class=na>api</span><span class=p>(</span><span class=s1>&#39;repo&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=o>-&gt;</span><span class=na>contents</span><span class=p>()</span>
</span></span><span class=line><span class=cl>                <span class=o>-&gt;</span><span class=na>readme</span><span class=p>(</span><span class=s1>&#39;laravel&#39;</span><span class=p>,</span> <span class=s1>&#39;laravel&#39;</span><span class=p>)[</span><span class=s1>&#39;contents&#39;</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=p>},</span> <span class=s1>&#39;laravel-readme.md&#39;</span><span class=p>);</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=文件响应>文件响应</h3><p><code>file</code>方法可用于直接在用户的浏览器中显示文件，例如图像或PDF，而不是启动下载。这个方法接受文件的路径作为它的第一个参数和一个标头数组作为它的第二个参数：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=k>return</span> <span class=nx>response</span><span class=p>()</span><span class=o>-&gt;</span><span class=na>file</span><span class=p>(</span><span class=nv>$pathToFile</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>return</span> <span class=nx>response</span><span class=p>()</span><span class=o>-&gt;</span><span class=na>file</span><span class=p>(</span><span class=nv>$pathToFile</span><span class=p>,</span> <span class=nv>$headers</span><span class=p>);</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=响应宏>响应宏</h2><p>如果想定义一个可以在各种路由和控制器中重复使用的自定义响应，可以使用<code>Response</code>facade上的<code>macro</code>方法。通常，应用从应用程序的服务提供者，如<code>App\Providers\AppServiceProvider</code>服务提供程序的<code>boot</code>方法调用此方法：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=o>&lt;?</span><span class=nx>php</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>namespace</span> <span class=nx>App\Providers</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>use</span> <span class=nx>Illuminate\Support\Facades\Response</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>use</span> <span class=nx>Illuminate\Support\ServiceProvider</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>AppServiceProvider</span> <span class=k>extends</span> <span class=nx>ServiceProvider</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=sd>/**
</span></span></span><span class=line><span class=cl><span class=sd>     * 启动一个应用的服务
</span></span></span><span class=line><span class=cl><span class=sd>     */</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=nf>boot</span><span class=p>()</span><span class=o>:</span> <span class=nx>void</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>Response</span><span class=o>::</span><span class=na>macro</span><span class=p>(</span><span class=s1>&#39;caps&#39;</span><span class=p>,</span> <span class=k>function</span> <span class=p>(</span><span class=nx>string</span> <span class=nv>$value</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=nx>Response</span><span class=o>::</span><span class=na>make</span><span class=p>(</span><span class=nx>strtoupper</span><span class=p>(</span><span class=nv>$value</span><span class=p>));</span>
</span></span><span class=line><span class=cl>        <span class=p>});</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p><code>macro</code>函数接受名称作为其第一个参数，并接受闭包作为其第二个参数。当从<code>ResponseFactory</code>实现或<code>response</code>助手函数调用宏名称时，将执行宏的闭包：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=k>return</span> <span class=nx>response</span><span class=p>()</span><span class=o>-&gt;</span><span class=na>caps</span><span class=p>(</span><span class=s1>&#39;foo&#39;</span><span class=p>);</span>
</span></span></code></pre></td></tr></table></div></div><h1 id=会话>会话</h1><h2 id=简介>简介</h2><p>由于HTTP驱动的应用程序是无状态的，Session提供了一种在多个请求之间存储有关用户信息的方法，这类信息一般都存储在后续请求可以访问的持久存储/后端中。</p><p>Laravel通过同一个可读性强的API处理各种自带的后台驱动程序。支持诸如比较热门的<code>Memcached</code>、<code>Redis</code>和数据库。</p><h3 id=配置>配置</h3><p>Session的配置文件存储在<code>config/session.php</code>文件中。默认情况下，Laravle为绝大多数应用程序配置的Session驱动为<code>file</code>驱动，它适用于大多数程序。如果应用程序需要再多个web服务器之间进行负载平衡，应该选择一个所有服务器都可以访问的几种式存储，例如Redis或数据库。</p><p>Session<code>driver</code>的配置预设了每个请求存储Session数据的位置。Laravel自带了几个不错而且开箱即用的驱动：</p><ul><li><code>file</code>：Session存储在<code>storage/framework/sessions</code></li><li><code>cookie</code>：Session存储在安全加密的cookie中</li><li><code>database</code>：Session储存在关系型数据库中</li><li><code>memcached</code>/<code>redis</code>：Session存储在基于高速缓存的存储系统中</li><li><code>dynamodb</code>：Session存储在AWS DynamoDB中</li><li><code>array</code>：Session存储在PHP数组中，不会被初九话</li></ul><h3 id=驱动先决条件>驱动先决条件</h3><h4 id=数据库>数据库</h4><p>使用<code>database</code>Session驱动时，需要创建一个记录Session的表。下面是<code>Schema</code>的声明示例：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=k>use</span> <span class=nx>Illuminate\Database\Schema\Blueprint</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>use</span> <span class=nx>Illuminate\Support\Facades\Schema</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>Schema</span><span class=o>::</span><span class=na>create</span><span class=p>(</span><span class=s1>&#39;sessions&#39;</span><span class=p>,</span> <span class=k>function</span> <span class=p>(</span><span class=nx>Blueprint</span> <span class=nv>$table</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nv>$table</span><span class=o>-&gt;</span><span class=na>string</span><span class=p>(</span><span class=s1>&#39;id&#39;</span><span class=p>)</span><span class=o>-&gt;</span><span class=na>primary</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=nv>$table</span><span class=o>-&gt;</span><span class=na>foreignId</span><span class=p>(</span><span class=s1>&#39;user_id&#39;</span><span class=p>)</span><span class=o>-&gt;</span><span class=na>nullable</span><span class=p>()</span><span class=o>-&gt;</span><span class=na>index</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=nv>$table</span><span class=o>-&gt;</span><span class=na>string</span><span class=p>(</span><span class=s1>&#39;ip_address&#39;</span><span class=p>,</span> <span class=mi>45</span><span class=p>)</span><span class=o>-&gt;</span><span class=na>nullable</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=nv>$table</span><span class=o>-&gt;</span><span class=na>text</span><span class=p>(</span><span class=s1>&#39;user_agent&#39;</span><span class=p>)</span><span class=o>-&gt;</span><span class=na>nullable</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=nv>$table</span><span class=o>-&gt;</span><span class=na>text</span><span class=p>(</span><span class=s1>&#39;payload&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nv>$table</span><span class=o>-&gt;</span><span class=na>integer</span><span class=p>(</span><span class=s1>&#39;last_activity&#39;</span><span class=p>)</span><span class=o>-&gt;</span><span class=na>index</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span></code></pre></td></tr></table></div></div><p>可以使用Artisan命令<code>session:table</code>生成这个迁移</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>php artisan session:table
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>php artisan migrate
</span></span></code></pre></td></tr></table></div></div><h4 id=redis>Redis</h4><p>在Laravel使用Redis Session驱动前，需要安装PhpReis PHP扩展，可以通过PECL/Composer安装<code>predis/predis</code>包。</p><h2 id=使用session>使用Session</h2><h3 id=获取数据>获取数据</h3><p>在 Laravel 中有两种基本的 Session 使用方式：全局 <code>session</code> 助手函数和通过 <code>Request</code> 实例。首先看下通过 <code>Request</code> 实例访问 Session , 它可以隐式绑定路由闭包或者控制器方法。记住，Laravel 会自动注入控制器方法的依赖。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=o>&lt;?</span><span class=nx>php</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>namespace</span> <span class=nx>App\Http\Controllers</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>use</span> <span class=nx>App\Http\Controllers\Controller</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>use</span> <span class=nx>Illuminate\Http\Request</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>use</span> <span class=nx>Illuminate\View\View</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>UserController</span> <span class=k>extends</span> <span class=nx>Controller</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=sd>/**
</span></span></span><span class=line><span class=cl><span class=sd>     * 显示指定用户个人资料。
</span></span></span><span class=line><span class=cl><span class=sd>     */</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=nf>show</span><span class=p>(</span><span class=nx>Request</span> <span class=nv>$request</span><span class=p>,</span> <span class=nx>string</span> <span class=nv>$id</span><span class=p>)</span><span class=o>:</span> <span class=nx>View</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nv>$value</span> <span class=o>=</span> <span class=nv>$request</span><span class=o>-&gt;</span><span class=na>session</span><span class=p>()</span><span class=o>-&gt;</span><span class=na>get</span><span class=p>(</span><span class=s1>&#39;key&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>        <span class=nv>$user</span> <span class=o>=</span> <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>users</span><span class=o>-&gt;</span><span class=na>find</span><span class=p>(</span><span class=nv>$id</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nx>view</span><span class=p>(</span><span class=s1>&#39;user.profile&#39;</span><span class=p>,</span> <span class=p>[</span><span class=s1>&#39;user&#39;</span> <span class=o>=&gt;</span> <span class=nv>$user</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>当从Session获取数据时，也可以在<code>get</code>方法第二个参数里传递一个default默认值，如果Session里不存在键值对key的数据结果，这个默认值就会返回。如果传递给<code>get</code>方法一个闭包作为默认值，这个闭包会被执行并且返回结果：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=nv>$value</span> <span class=o>=</span> <span class=nv>$request</span><span class=o>-&gt;</span><span class=na>session</span><span class=p>()</span><span class=o>-&gt;</span><span class=na>get</span><span class=p>(</span><span class=s1>&#39;key&#39;</span><span class=p>,</span> <span class=s1>&#39;default&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>$value</span> <span class=o>=</span> <span class=nv>$request</span><span class=o>-&gt;</span><span class=na>session</span><span class=p>()</span><span class=o>-&gt;</span><span class=na>get</span><span class=p>(</span><span class=s1>&#39;key&#39;</span><span class=p>,</span> <span class=k>function</span> <span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=s1>&#39;default&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=全局session助手函数>全局Session助手函数</h4><p>可以在Session里使用PHP全局<code>session</code>函数获取和存储数据。当这个<code>session</code>函数以一个单独的字符串形式被调用时，它将返回这个Session键值对的结果。当函数以key-value数组形式被调用时，这些值会被存储在Session中：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=nx>Route</span><span class=o>::</span><span class=na>get</span><span class=p>(</span><span class=s1>&#39;/home&#39;</span><span class=p>,</span> <span class=k>function</span> <span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 从 Session 获取数据 ...
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nv>$value</span> <span class=o>=</span> <span class=nx>session</span><span class=p>(</span><span class=s1>&#39;key&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// 设置默认值...
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nv>$value</span> <span class=o>=</span> <span class=nx>session</span><span class=p>(</span><span class=s1>&#39;key&#39;</span><span class=p>,</span> <span class=s1>&#39;default&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// 在Session 里存储一段数据 ...
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>session</span><span class=p>([</span><span class=s1>&#39;key&#39;</span> <span class=o>=&gt;</span> <span class=s1>&#39;value&#39;</span><span class=p>]);</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=获取所有session数据>获取所有Session数据</h4><p>可以使用<code>all</code>方法从Session里获取所有数据：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=nv>$data</span> <span class=o>=</span> <span class=nv>$request</span><span class=o>-&gt;</span><span class=na>session</span><span class=p>()</span><span class=o>-&gt;</span><span class=na>all</span><span class=p>();</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=判断session里是否存在条目>判断Session里是否存在条目</h4><p>可以使用<code>has</code>方法。如果条目存在返回<code>true</code>，否则返回<code>null</code>：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=k>if</span> <span class=p>(</span><span class=nv>$request</span><span class=o>-&gt;</span><span class=na>session</span><span class=p>()</span><span class=o>-&gt;</span><span class=na>has</span><span class=p>(</span><span class=s1>&#39;users&#39;</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>判断 Session 里是否存在一个即使结果值为 <code>null</code> 的条目，可以使用 <code>exists</code> 方法：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=k>if</span> <span class=p>(</span><span class=nv>$request</span><span class=o>-&gt;</span><span class=na>session</span><span class=p>()</span><span class=o>-&gt;</span><span class=na>exists</span><span class=p>(</span><span class=s1>&#39;users&#39;</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>要确定某个条目是否在会话中不存在，可以使用 <code>missing</code> 方法。如果条目不存在，<code>missing</code> 方法返回 <code>true</code>：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=k>if</span> <span class=p>(</span><span class=nv>$request</span><span class=o>-&gt;</span><span class=na>session</span><span class=p>()</span><span class=o>-&gt;</span><span class=na>missing</span><span class=p>(</span><span class=s1>&#39;users&#39;</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=存储数据>存储数据</h3><p>Session 里存储数据，通常将使用 Request 实例中的 <code>put</code> 方法或者 <code>session</code> 助手函数：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=c1>// 通过 Request 实例存储 ...
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nv>$request</span><span class=o>-&gt;</span><span class=na>session</span><span class=p>()</span><span class=o>-&gt;</span><span class=na>put</span><span class=p>(</span><span class=s1>&#39;key&#39;</span><span class=p>,</span> <span class=s1>&#39;value&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 通过全局 Session 助手函数存储 ...
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>session</span><span class=p>([</span><span class=s1>&#39;key&#39;</span> <span class=o>=&gt;</span> <span class=s1>&#39;value&#39;</span><span class=p>]);</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=session存储数组>Session存储数组</h4><p><code>push</code> 方法可以把一个新值推入到以数组形式存储的 session 值里。例如：如果 <code>user.teams</code> 键值对有一个关于团队名字的数组，可以推入一个新值到这个数组里：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=nv>$request</span><span class=o>-&gt;</span><span class=na>session</span><span class=p>()</span><span class=o>-&gt;</span><span class=na>push</span><span class=p>(</span><span class=s1>&#39;user.teams&#39;</span><span class=p>,</span> <span class=s1>&#39;developers&#39;</span><span class=p>);</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=获取删除条目>获取&删除条目</h4><p><code>pull</code> 方法会从 Session 里获取并且删除一个条目：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=nv>$value</span> <span class=o>=</span> <span class=nv>$request</span><span class=o>-&gt;</span><span class=na>session</span><span class=p>()</span><span class=o>-&gt;</span><span class=na>pull</span><span class=p>(</span><span class=s1>&#39;key&#39;</span><span class=p>,</span> <span class=s1>&#39;default&#39;</span><span class=p>);</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=递增递减会话值>递增、递减会话值</h4><p>如果 Session 数据里有整形希望进行加减操作，可以使用 <code>increment</code> 和 <code>decrement</code> 方法：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=nv>$request</span><span class=o>-&gt;</span><span class=na>session</span><span class=p>()</span><span class=o>-&gt;</span><span class=na>increment</span><span class=p>(</span><span class=s1>&#39;count&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>$request</span><span class=o>-&gt;</span><span class=na>session</span><span class=p>()</span><span class=o>-&gt;</span><span class=na>increment</span><span class=p>(</span><span class=s1>&#39;count&#39;</span><span class=p>,</span> <span class=nv>$incrementBy</span> <span class=o>=</span> <span class=mi>2</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>$request</span><span class=o>-&gt;</span><span class=na>session</span><span class=p>()</span><span class=o>-&gt;</span><span class=na>decrement</span><span class=p>(</span><span class=s1>&#39;count&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>$request</span><span class=o>-&gt;</span><span class=na>session</span><span class=p>()</span><span class=o>-&gt;</span><span class=na>decrement</span><span class=p>(</span><span class=s1>&#39;count&#39;</span><span class=p>,</span> <span class=nv>$decrementBy</span> <span class=o>=</span> <span class=mi>2</span><span class=p>);</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=闪存数据>闪存数据</h3><p>有时可能想在 Session 里为下次请求存储一些条目。可以使用 <code>flash</code> 方法。使用这个方法，存储在 Session 的数据将立即可用并且会保留到下一个 HTTP 请求期间，之后会被删除。闪存数据主要用于短期的状态消息：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=nv>$request</span><span class=o>-&gt;</span><span class=na>session</span><span class=p>()</span><span class=o>-&gt;</span><span class=na>flash</span><span class=p>(</span><span class=s1>&#39;status&#39;</span><span class=p>,</span> <span class=s1>&#39;Task was successful!&#39;</span><span class=p>);</span>
</span></span></code></pre></td></tr></table></div></div><p>如果需要为多次请求持久化闪存数据，可以使用 <code>reflash</code> 方法，它会为一个额外的请求保持住所有的闪存数据，如果仅需要保持特定的闪存数据，可以使用 <code>keep</code> 方法：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=nv>$request</span><span class=o>-&gt;</span><span class=na>session</span><span class=p>()</span><span class=o>-&gt;</span><span class=na>reflash</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>$request</span><span class=o>-&gt;</span><span class=na>session</span><span class=p>()</span><span class=o>-&gt;</span><span class=na>keep</span><span class=p>([</span><span class=s1>&#39;username&#39;</span><span class=p>,</span> <span class=s1>&#39;email&#39;</span><span class=p>]);</span>
</span></span></code></pre></td></tr></table></div></div><p>如果仅为了当前的请求持久化闪存数据，可以使用 <code>now</code> 方法：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=nv>$request</span><span class=o>-&gt;</span><span class=na>session</span><span class=p>()</span><span class=o>-&gt;</span><span class=na>now</span><span class=p>(</span><span class=s1>&#39;status&#39;</span><span class=p>,</span> <span class=s1>&#39;Task was successful!&#39;</span><span class=p>);</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=删除数据>删除数据</h3><p><code>forget</code> 方法会从 Session 删除一些数据。如果想删除所有 Session 数据，可以使用 <code>flush</code> 方法：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=c1>// 删除一个单独的键值对 ...
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nv>$request</span><span class=o>-&gt;</span><span class=na>session</span><span class=p>()</span><span class=o>-&gt;</span><span class=na>forget</span><span class=p>(</span><span class=s1>&#39;name&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 删除多个 键值对 ...
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nv>$request</span><span class=o>-&gt;</span><span class=na>session</span><span class=p>()</span><span class=o>-&gt;</span><span class=na>forget</span><span class=p>([</span><span class=s1>&#39;name&#39;</span><span class=p>,</span> <span class=s1>&#39;status&#39;</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>$request</span><span class=o>-&gt;</span><span class=na>session</span><span class=p>()</span><span class=o>-&gt;</span><span class=na>flush</span><span class=p>();</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=重新生成sessionid>重新生成SessionID</h3><p>重新生成 Session ID 经常被用来阻止恶意用户使用 session fixation 攻击你的应用。</p><p>如果正在使用入门套件或 Laravel Fortify 中的任意一种， Laravel 会在认证阶段自动生成 Session ID；然而如果需要手动重新生成 Session ID ，可以使用<code> regenerate</code> 方法：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=nv>$request</span><span class=o>-&gt;</span><span class=na>session</span><span class=p>()</span><span class=o>-&gt;</span><span class=na>regenerate</span><span class=p>();</span>
</span></span></code></pre></td></tr></table></div></div><p>如果需要重新生成 Session ID 并同时删除所有 Session 里的数据，可以使用 <code>invalidate</code> 方法：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=nv>$request</span><span class=o>-&gt;</span><span class=na>session</span><span class=p>()</span><span class=o>-&gt;</span><span class=na>invalidate</span><span class=p>();</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=session阻塞>Session阻塞</h2><p>默认情况下，Laravel 允许使用同一 Session 的请求并发地执行，举例来说，如果使用一个 JavaScript HTTP 库向你的应用执行两次 HTTP 请求，它们将同时执行。对多数应用这不是问题，然而 在一小部分应用中可能出现 Session 数据丢失，这些应用会向两个不同的应用端并发请求，并同时写入数据到 Session。</p><p>为了解决这个问题，Laravel 允许限制指定 Session 的并发请求。首先，可以在路由定义时使用 <code>block</code> 链式方法。在这个示例中，一个到 <code>/profile</code> 的路由请求会拿到一把 Session 锁。当它处在锁定状态时，任何使用相同 Session ID 的到 <code>/profile</code> 或 <code>/order</code> 的路由请求都必须等待，直到第一个请求处理完成后再继续执行：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=nx>Route</span><span class=o>::</span><span class=na>post</span><span class=p>(</span><span class=s1>&#39;/profile&#39;</span><span class=p>,</span> <span class=k>function</span> <span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>})</span><span class=o>-&gt;</span><span class=na>block</span><span class=p>(</span><span class=nv>$lockSeconds</span> <span class=o>=</span> <span class=mi>10</span><span class=p>,</span> <span class=nv>$waitSeconds</span> <span class=o>=</span> <span class=mi>10</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>Route</span><span class=o>::</span><span class=na>post</span><span class=p>(</span><span class=s1>&#39;/order&#39;</span><span class=p>,</span> <span class=k>function</span> <span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>})</span><span class=o>-&gt;</span><span class=na>block</span><span class=p>(</span><span class=nv>$lockSeconds</span> <span class=o>=</span> <span class=mi>10</span><span class=p>,</span> <span class=nv>$waitSeconds</span> <span class=o>=</span> <span class=mi>10</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><p><code>block</code> 方法接受两个可选参数。<code>block</code> 方法接受的第一个参数是 Session 锁释放前应该持有的最大秒数。当然，如果请求在此时间之前完成执行，锁将提前释放。</p><p><code>block</code> 方法接受的第二个参数是请求在试图获得 Session 锁时应该等待的秒数。如果请求在给定的秒数内无法获得会话锁，将抛出 <code>Illuminate\Contracts\Cache\LockTimeoutException</code> 异常。</p><p>如果不传参，那么 Session 锁默认锁定最大时间是 10 秒，请求锁最大的等待时间也是 10 秒：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=nx>Route</span><span class=o>::</span><span class=na>post</span><span class=p>(</span><span class=s1>&#39;/profile&#39;</span><span class=p>,</span> <span class=k>function</span> <span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>})</span><span class=o>-&gt;</span><span class=na>block</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=添加自定义session驱动>添加自定义Session驱动</h2><h4 id=实现驱动>实现驱动</h4><p>如果现存的 Session 驱动不能满足需求，Laravel 允许自定义 Session Handler。自定义驱动应实现 PHP 内置的 <code>SessionHandlerInterface</code>。这个接口仅包含几个方法。以下是 MongoDB 驱动实现的代码片段：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=o>&lt;?</span><span class=nx>php</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>namespace</span> <span class=nx>App\Extensions</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>MongoSessionHandler</span> <span class=k>implements</span> <span class=nx>\SessionHandlerInterface</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=nf>open</span><span class=p>(</span><span class=nv>$savePath</span><span class=p>,</span> <span class=nv>$sessionName</span><span class=p>)</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=nf>close</span><span class=p>()</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=nf>read</span><span class=p>(</span><span class=nv>$sessionId</span><span class=p>)</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=nf>write</span><span class=p>(</span><span class=nv>$sessionId</span><span class=p>,</span> <span class=nv>$data</span><span class=p>)</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=nf>destroy</span><span class=p>(</span><span class=nv>$sessionId</span><span class=p>)</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=nf>gc</span><span class=p>(</span><span class=nv>$lifetime</span><span class=p>)</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>注：Laravel 没有内置存放扩展的目录，可以放置在任意目录下，这个示例里，创建了一个 <code>Extensions</code> 目录存放 <code>MongoSessionHandler</code>。</p><ul><li><code>open</code> 方法通常用于基于文件的 Session 存储系统。因为 Laravel 附带了一个<code>file</code>Session 驱动。你无须在里面写任何代码。可以简单地忽略掉。</li><li><code>close</code> 方法跟 <code>open</code> 方法很像，通常也可以忽略掉。对大多数驱动来说，它不是必须的。</li><li><code>read</code> 方法应返回与给定的 <code>$sessionId</code> 关联的 Session 数据的字符串格式。在你的驱动中获取或存储 Session 数据时，无须作任何序列化和编码的操作，Laravel 会自动为你执行序列化。</li><li><code>write</code> 方法将与 <code>$sessionId</code> 关联的给定的 <code>$data</code> 字符串写入到一些持久化存储系统，如 MongoDB 或者其他你选择的存储系统。再次，你无须进行任何序列化操作，Laravel 会自动为你处理。</li><li><code>destroy</code> 方法应可以从持久化存储中删除与 <code>$sessionId</code> 相关联的数据。</li><li><code>gc</code> 方法应可以销毁给定的 <code>$lifetime</code>（UNIX 时间戳格式 ）之前的所有 Session 数据。对于像 Memcached 和 Redis 这类拥有过期机制的系统来说，本方法可以置空。</li></ul><h4 id=注册驱动>注册驱动</h4><p>在 Laravel 中添加额外的驱动到 Session 后端 ，可以使用 <code>Session</code> Facade 提供的 <code>extend</code> 方法。你应该在服务提供者中的 <code>boot</code> 方法中调用 extend 方法。可以通过已有的<code> App\Providers\AppServiceProvider</code> 或创建一个全新的服务提供者执行此操作：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=o>&lt;?</span><span class=nx>php</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>namespace</span> <span class=nx>App\Providers</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>use</span> <span class=nx>App\Extensions\MongoSessionHandler</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>use</span> <span class=nx>Illuminate\Contracts\Foundation\Application</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>use</span> <span class=nx>Illuminate\Support\Facades\Session</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>use</span> <span class=nx>Illuminate\Support\ServiceProvider</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>SessionServiceProvider</span> <span class=k>extends</span> <span class=nx>ServiceProvider</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=sd>/**
</span></span></span><span class=line><span class=cl><span class=sd>     * 注册任意应用服务。
</span></span></span><span class=line><span class=cl><span class=sd>     */</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=nf>register</span><span class=p>()</span><span class=o>:</span> <span class=nx>void</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=sd>/**
</span></span></span><span class=line><span class=cl><span class=sd>     * 启动任意应用服务。
</span></span></span><span class=line><span class=cl><span class=sd>     */</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=nf>boot</span><span class=p>()</span><span class=o>:</span> <span class=nx>void</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>Session</span><span class=o>::</span><span class=na>extend</span><span class=p>(</span><span class=s1>&#39;mongo&#39;</span><span class=p>,</span> <span class=k>function</span> <span class=p>(</span><span class=nx>Application</span> <span class=nv>$app</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=c1>// 返回一个 SessionHandlerInterface 接口的实现 ...
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=k>return</span> <span class=k>new</span> <span class=nx>MongoSessionHandler</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>});</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>一旦 Session 驱动注册完成，就可以在 <code>config/session.php</code> 配置文件选择使用 <code>mongo</code> 驱动。</p></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span>更新于 2023年05月08日</span></div></div><div class=post-info-line><div class=post-info-md><span><a class=link-to-markdown href=/2023/05/learn01/index.md target=_blank>阅读原始文档</a></span></div><div class=post-info-share><span><a href=javascript:void(0); title="分享到 Twitter" data-sharer=twitter data-url=https://Joker-desire.github.io/2023/05/learn01/ data-title="Laravel 路由" data-hashtags=PHP,Laravel><i class="fab fa-twitter fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="分享到 Facebook" data-sharer=facebook data-url=https://Joker-desire.github.io/2023/05/learn01/ data-hashtag=PHP><i class="fab fa-facebook-square fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="分享到 Hacker News" data-sharer=hackernews data-url=https://Joker-desire.github.io/2023/05/learn01/ data-title="Laravel 路由"><i class="fab fa-hacker-news fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="分享到 Line" data-sharer=line data-url=https://Joker-desire.github.io/2023/05/learn01/ data-title="Laravel 路由"><i data-svg-src=https://cdn.jsdelivr.net/npm/simple-icons@7.0.0/icons/line.svg aria-hidden=true></i></a><a href=javascript:void(0); title="分享到 微博" data-sharer=weibo data-url=https://Joker-desire.github.io/2023/05/learn01/ data-title="Laravel 路由"><i class="fab fa-weibo fa-fw" aria-hidden=true></i></a></span></div></div></div><div class=post-info-more><section class=post-tags><i class="fas fa-tags fa-fw" aria-hidden=true></i>&nbsp;<a href=/tags/php/>PHP</a>,&nbsp;<a href=/tags/laravel/>Laravel</a></section><section><span><a href=javascript:void(0); onclick=window.history.back()>返回</a></span>&nbsp;|&nbsp;<span><a href=/>主页</a></span></section></div><div class=post-nav><a href=/2023/04/php%E5%85%A5%E9%97%A8/ class=prev rel=prev title=PHP入门><i class="fas fa-angle-left fa-fw" aria-hidden=true></i>PHP入门</a>
<a href=/2023/05/go%E7%BB%93%E6%9E%84%E4%BD%93/ class=next rel=next title=Go结构体>Go结构体<i class="fas fa-angle-right fa-fw" aria-hidden=true></i></a></div></div><div id=comments><div id=giscus class=comment></div><noscript>Please enable JavaScript to view the comments powered by <a href=https://giscus.app>Giscus</a>.</noscript></div></article></div></main><footer class=footer><div class=footer-container><div class=footer-line itemscope itemtype=http://schema.org/CreativeWork><i class="far fa-copyright fa-fw" aria-hidden=true></i><span itemprop=copyrightYear>2022 - 2024</span><span class=author itemprop=copyrightHolder>&nbsp;<a href=/ target=_blank>Joker desire</a></span>&nbsp;|&nbsp;<span class=license><a rel="license external nofollow noopener noreffer" href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></span></div></div></footer></div><div id=fixed-buttons><a href=# id=back-to-top class=fixed-button title=回到顶部><i class="fas fa-arrow-up fa-fw" aria-hidden=true></i>
</a><a href=# id=view-comments class=fixed-button title=查看评论><i class="fas fa-comment fa-fw" aria-hidden=true></i></a></div><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/lightgallery@2.4.0/css/lightgallery-bundle.min.css><script type=text/javascript src=https://cdn.jsdelivr.net/npm/autocomplete.js@0.38.1/dist/autocomplete.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/algoliasearch@4.13.1/dist/algoliasearch-lite.umd.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/lazysizes@5.3.1/lazysizes.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/lightgallery@2.4.0/lightgallery.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/lightgallery@2.4.0/plugins/thumbnail/lg-thumbnail.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/lightgallery@2.4.0/plugins/zoom/lg-zoom.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/clipboard@2.0.11/dist/clipboard.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/sharer.js@0.5.1/sharer.min.js></script><script type=text/javascript>window.config={code:{copyTitle:"复制到剪贴板",maxShownLines:50},comment:{giscus:{category:"Announcements",categoryId:"DIC_kwDOHfPihs4CPp7X",darkTheme:"dark",emitMetadata:"0",inputPosition:"top",lang:"zh-CN",lazyLoading:!1,lightTheme:"light",mapping:"pathname",reactionsEnabled:"1",repo:"Joker-desire/store-comments",repoId:"R_kgDOHfPihg"}},lightgallery:!0,search:{algoliaAppID:"R6OIVCXBNU",algoliaIndex:"Joker-desire",algoliaSearchKey:"07e68b90760663e43882d4a48e00e932",highlightTag:"em",maxResultLength:10,noResultsFound:"没有找到结果",snippetLength:30,type:"algolia"}}</script><script type=text/javascript src=/js/theme.min.js></script></body></html>